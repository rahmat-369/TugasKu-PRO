<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>TugasKu beta - Manajemen Tugas Premium</title>
  <meta name="app-version" content="5.0.0">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="my-icon.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#8B5CF6">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <style>
    /* CSS Variables & Base Styles */
    :root {
      --primary: #8B5CF6;
      --primary-600: #7C3AED;
      --bg: #0f172a;
      --bg-card: #1e293b;
      --card: #1e293b;
      --muted: #94a3b8;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --glass: rgba(30, 41, 59, 0.6);
      --radius: 16px;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
      --priority-high: #ef4444;
      --priority-medium: #f59e0b;
      --priority-low: #10b981;
      --toast-bg: #1e293b;
      --toast-text: #ffffff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* TEMA TERANG NORMAL */
    .light-mode {
      --bg: #f8fafc;
      --bg-card: #ffffff;
      --card: #ffffff;
      --muted: #6b7280;
      --glass: rgba(255,255,255,0.7);
      --toast-bg: #ffffff;
      --toast-text: #1f2937;
      color-scheme: light;
      color: #0f1724;
    }
    
    /* TEMA GELAP PROFESIONAL */
    .dark-pro-mode {
      --primary: #00c8ff;
      --primary-600: #00a8d6;
      --bg: linear-gradient(180deg, #0b0f16, #121821);
      --bg-card: #1c2430;
      --card: #1c2430;
      --muted: #a0aec0;
      --glass: rgba(28, 36, 48, 0.7);
      --toast-bg: #1c2430;
      --toast-text: #e8edf2;
      color: #e8edf2;
      --shadow: 0 10px 25px rgba(0,0,0,0.4);
    }
    
    /* TEMA GELAP PROFESIONAL SHIFT (BARU) */
    .dark-pro-shift-mode {
      --primary: #8B5CF6;
      --primary-600: #7C3AED;
      --bg: linear-gradient(135deg, #0f172a, #1e1b4b);
      --bg-card: #1e293b;
      --card: #1e293b;
      --muted: #94a3b8;
      --glass: rgba(30, 41, 59, 0.6);
      --toast-bg: #1e293b;
      --toast-text: #e8edf2;
      color: #e8edf2;
      --shadow: 0 10px 25px rgba(0,0,0,0.4);
    }
    
    /* TEMA MIDNIGHT TECH (BARU) */
    .midnight-tech-mode {
      --primary: #38bdf8;
      --primary-600: #0ea5e9;
      --bg: #0f172a;
      --bg-card: #1e293b;
      --card: #1e293b;
      --muted: #94a3b8;
      --glass: rgba(30, 41, 59, 0.6);
      --toast-bg: #1e293b;
      --toast-text: #f8fafc;
      color: #f8fafc;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA CARBON BLUE (BARU) */
    .carbon-blue-mode {
      --primary: #3b82f6;
      --primary-600: #2563eb;
      --bg: #1e293b;
      --bg-card: #334155;
      --card: #334155;
      --muted: #cbd5e1;
      --glass: rgba(51, 65, 85, 0.6);
      --toast-bg: #334155;
      --toast-text: #f1f5f9;
      color: #f1f5f9;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA CYBER GRAY (DIPERBAIKI) */
    .cyber-gray-mode {
      --primary: #22d3ee;
      --primary-600: #06b6d4;
      --bg: #111827;
      --bg-card: #1f2937;
      --card: #1f2937;
      --muted: #9ca3af;
      --glass: rgba(31, 41, 55, 0.6);
      --toast-bg: #1f2937;
      --toast-text: #e2e8f0;
      color: #e2e8f0;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA BLUE MIST (DIPERBAIKI) */
    .blue-mist-mode {
      --primary: #64ffda;
      --primary-600: #48cae4;
      --bg: #0a192f;
      --bg-card: #112240;
      --card: #112240;
      --muted: #8892b0;
      --glass: rgba(17, 34, 64, 0.6);
      --toast-bg: #112240;
      --toast-text: #e0fbfc;
      color: #e0fbfc;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA PINK ELEGAN (BARU) */
    .pink-elegant-mode {
      --primary: #ec4899;
      --primary-600: #db2777;
      --bg: linear-gradient(135deg, #1f1b2e, #2d1b3e);
      --bg-card: #2d1b3e;
      --card: #2d1b3e;
      --muted: #c4b5fd;
      --glass: rgba(45, 27, 62, 0.6);
      --toast-bg: #2d1b3e;
      --toast-text: #fdf2f8;
      color: #fdf2f8;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA PRO GOLD (PREMIUM BETA) */
    .pro-gold-mode {
      --primary: #FFD700;
      --primary-600: #D4AF37;
      --bg: linear-gradient(135deg, #1a1a1a, #2d2d2d);
      --bg-card: #2d2d2d;
      --card: #2d2d2d;
      --muted: #b0b0b0;
      --glass: rgba(45, 45, 45, 0.7);
      --toast-bg: #2d2d2d;
      --toast-text: #f8f8f8;
      color: #f8f8f8;
      --shadow: 0 10px 25px rgba(0,0,0,0.4);
    }
    
    /* TEMA PRO DEEP OCEAN (PREMIUM) */
    .pro-deep-ocean-mode {
      --primary: #00B4D8;
      --primary-600: #0077B6;
      --bg: linear-gradient(135deg, #001219, #005f73);
      --bg-card: #0a9396;
      --card: #0a9396;
      --muted: #94d2bd;
      --glass: rgba(10, 147, 150, 0.6);
      --toast-bg: #0a9396;
      --toast-text: #e9d8a6;
      color: #e9d8a6;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA PRO FOREST (PREMIUM) */
    .pro-forest-mode {
      --primary: #2A9D8F;
      --primary-600: #264653;
      --bg: linear-gradient(135deg, #1a2f1a, #2d4a2d);
      --bg-card: #2d4a2d;
      --card: #2d4a2d;
      --muted: #a3b18a;
      --glass: rgba(45, 74, 45, 0.6);
      --toast-bg: #2d4a2d;
      --toast-text: #dad7cd;
      color: #dad7cd;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* Efek Glow untuk Prioritas Tinggi */
    .priority-high-indicator {
      box-shadow: 0 0 8px 2px rgba(239, 68, 68, 0.7);
      animation: pulse-high 2s infinite;
    }
    
    @keyframes pulse-high {
      0% {
        box-shadow: 0 0 8px 2px rgba(239, 68, 68, 0.7);
      }
      50% {
        box-shadow: 0 0 12px 4px rgba(239, 68, 68, 0.9);
      }
      100% {
        box-shadow: 0 0 8px 2px rgba(239, 68, 68, 0.7);
      }
    }
    
    /* Efek untuk tema premium */
    .pro-gold-mode .card,
    .pro-gold-mode .task-card,
    .pro-gold-mode .schedule-item,
    .pro-gold-mode .note-card,
    .pro-gold-mode .stat-card,
    .pro-gold-mode .form-section,
    .pro-gold-mode .about-section,
    .pro-gold-mode .stats-section,
    .pro-gold-mode header,
    .pro-gold-mode .calendar-day,
    .pro-gold-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(255,215,0,0.15),
        inset 0 0 5px rgba(255,215,0,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .pro-gold-mode .card:hover,
    .pro-gold-mode .task-card:hover,
    .pro-gold-mode .schedule-item:hover,
    .pro-gold-mode .note-card:hover,
    .pro-gold-mode .stat-card:hover,
    .pro-gold-mode .form-section:hover,
    .pro-gold-mode .about-section:hover,
    .pro-gold-mode .stats-section:hover,
    .pro-gold-mode header:hover,
    .pro-gold-mode .calendar-day:hover,
    .pro-gold-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(255,215,0,0.3),
        inset 0 0 10px rgba(255,215,0,0.1);
    }
    
    .pro-gold-mode .fab {
      box-shadow: 
        0 18px 40px rgba(255,215,0,0.4),
        0 0 15px rgba(255,215,0,0.2);
    }
    
    .pro-gold-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(255,215,0,0.6),
        0 0 20px rgba(255,215,0,0.3);
    }
    
    .pro-gold-mode .btn,
    .pro-gold-mode .filter-btn.active,
    .pro-gold-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(255,215,0,0.3);
    }
    
    .pro-gold-mode .btn:hover,
    .pro-gold-mode .filter-btn.active:hover,
    .pro-gold-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(255,215,0,0.4);
    }
    
    .pro-gold-mode .brand h1 {
      background: linear-gradient(135deg, #FFD700, #D4AF37);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    /* Efek untuk tema Deep Ocean */
    .pro-deep-ocean-mode .card,
    .pro-deep-ocean-mode .task-card,
    .pro-deep-ocean-mode .schedule-item,
    .pro-deep-ocean-mode .note-card,
    .pro-deep-ocean-mode .stat-card,
    .pro-deep-ocean-mode .form-section,
    .pro-deep-ocean-mode .about-section,
    .pro-deep-ocean-mode .stats-section,
    .pro-deep-ocean-mode header,
    .pro-deep-ocean-mode .calendar-day,
    .pro-deep-ocean-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(0,180,216,0.15),
        inset 0 0 5px rgba(0,180,216,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .pro-deep-ocean-mode .card:hover,
    .pro-deep-ocean-mode .task-card:hover,
    .pro-deep-ocean-mode .schedule-item:hover,
    .pro-deep-ocean-mode .note-card:hover,
    .pro-deep-ocean-mode .stat-card:hover,
    .pro-deep-ocean-mode .form-section:hover,
    .pro-deep-ocean-mode .about-section:hover,
    .pro-deep-ocean-mode .stats-section:hover,
    .pro-deep-ocean-mode header:hover,
    .pro-deep-ocean-mode .calendar-day:hover,
    .pro-deep-ocean-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(0,180,216,0.3),
        inset 0 0 10px rgba(0,180,216,0.1);
    }
    
    .pro-deep-ocean-mode .fab {
      box-shadow: 
        0 18px 40px rgba(0,180,216,0.4),
        0 0 15px rgba(0,180,216,0.2);
    }
    
    .pro-deep-ocean-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(0,180,216,0.6),
        0 0 20px rgba(0,180,216,0.3);
    }
    
    .pro-deep-ocean-mode .btn,
    .pro-deep-ocean-mode .filter-btn.active,
    .pro-deep-ocean-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(0,180,216,0.3);
    }
    
    .pro-deep-ocean-mode .btn:hover,
    .pro-deep-ocean-mode .filter-btn.active:hover,
    .pro-deep-ocean-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(0,180,216,0.4);
    }
    
    .pro-deep-ocean-mode .brand h1 {
      background: linear-gradient(135deg, #00B4D8, #0077B6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    /* Efek untuk tema Forest */
    .pro-forest-mode .card,
    .pro-forest-mode .task-card,
    .pro-forest-mode .schedule-item,
    .pro-forest-mode .note-card,
    .pro-forest-mode .stat-card,
    .pro-forest-mode .form-section,
    .pro-forest-mode .about-section,
    .pro-forest-mode .stats-section,
    .pro-forest-mode header,
    .pro-forest-mode .calendar-day,
    .pro-forest-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(42,157,143,0.15),
        inset 0 0 5px rgba(42,157,143,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .pro-forest-mode .card:hover,
    .pro-forest-mode .task-card:hover,
    .pro-forest-mode .schedule-item:hover,
    .pro-forest-mode .note-card:hover,
    .pro-forest-mode .stat-card:hover,
    .pro-forest-mode .form-section:hover,
    .pro-forest-mode .about-section:hover,
    .pro-forest-mode .stats-section:hover,
    .pro-forest-mode header:hover,
    .pro-forest-mode .calendar-day:hover,
    .pro-forest-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(42,157,143,0.3),
        inset 0 0 10px rgba(42,157,143,0.1);
    }
    
    .pro-forest-mode .fab {
      box-shadow: 
        0 18px 40px rgba(42,157,143,0.4),
        0 0 15px rgba(42,157,143,0.2);
    }
    
    .pro-forest-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(42,157,143,0.6),
        0 0 20px rgba(42,157,143,0.3);
    }
    
    .pro-forest-mode .btn,
    .pro-forest-mode .filter-btn.active,
    .pro-forest-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(42,157,143,0.3);
    }
    
    .pro-forest-mode .btn:hover,
    .pro-forest-mode .filter-btn.active:hover,
    .pro-forest-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(42,157,143,0.4);
    }
    
    .pro-forest-mode .brand h1 {
      background: linear-gradient(135deg, #2A9D8F, #264653);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    /* Efek Glow untuk Tema Gelap Profesional */
    .dark-pro-mode .card,
    .dark-pro-mode .task-card,
    .dark-pro-mode .schedule-item,
    .dark-pro-mode .note-card,
    .dark-pro-mode .stat-card,
    .dark-pro-mode .form-section,
    .dark-pro-mode .about-section,
    .dark-pro-mode .stats-section,
    .dark-pro-mode header,
    .dark-pro-mode .calendar-day,
    .dark-pro-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(0,200,255,0.15),
        inset 0 0 5px rgba(0,200,255,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .dark-pro-mode .card:hover,
    .dark-pro-mode .task-card:hover,
    .dark-pro-mode .schedule-item:hover,
    .dark-pro-mode .note-card:hover,
    .dark-pro-mode .stat-card:hover,
    .dark-pro-mode .form-section:hover,
    .dark-pro-mode .about-section:hover,
    .dark-pro-mode .stats-section:hover,
    .dark-pro-mode header:hover,
    .dark-pro-mode .calendar-day:hover,
    .dark-pro-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(0,200,255,0.3),
        inset 0 0 10px rgba(0,200,255,0.1);
    }
    
    .dark-pro-mode .fab {
      box-shadow: 
        0 18px 40px rgba(0,200,255,0.4),
        0 0 15px rgba(0,200,255,0.2);
    }
    
    .dark-pro-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(0,200,255,0.6),
        0 0 20px rgba(0,200,255,0.3);
    }
    
    .dark-pro-mode .btn,
    .dark-pro-mode .filter-btn.active,
    .dark-pro-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(0,200,255,0.3);
    }
    
    .dark-pro-mode .btn:hover,
    .dark-pro-mode .filter-btn.active:hover,
    .dark-pro-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(0,200,255,0.4);
    }
    
    /* Efek Glow untuk Tema Gelap Profesional Shift */
    .dark-pro-shift-mode .card,
    .dark-pro-shift-mode .task-card,
    .dark-pro-shift-mode .schedule-item,
    .dark-pro-shift-mode .note-card,
    .dark-pro-shift-mode .stat-card,
    .dark-pro-shift-mode .form-section,
    .dark-pro-shift-mode .about-section,
    .dark-pro-shift-mode .stats-section,
    .dark-pro-shift-mode header,
    .dark-pro-shift-mode .calendar-day,
    .dark-pro-shift-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(139,92,246,0.15),
        inset 0 0 5px rgba(139,92,246,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .dark-pro-shift-mode .card:hover,
    .dark-pro-shift-mode .task-card:hover,
    .dark-pro-shift-mode .schedule-item:hover,
    .dark-pro-shift-mode .note-card:hover,
    .dark-pro-shift-mode .stat-card:hover,
    .dark-pro-shift-mode .form-section:hover,
    .dark-pro-shift-mode .about-section:hover,
    .dark-pro-shift-mode .stats-section:hover,
    .dark-pro-shift-mode header:hover,
    .dark-pro-shift-mode .calendar-day:hover,
    .dark-pro-shift-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(139,92,246,0.3),
        inset 0 0 10px rgba(139,92,246,0.1);
    }
    
    .dark-pro-shift-mode .fab {
      box-shadow: 
        0 18px 40px rgba(139,92,246,0.4),
        0 0 15px rgba(139,92,246,0.2);
    }
    
    .dark-pro-shift-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(139,92,246,0.6),
        0 0 20px rgba(139,92,246,0.3);
    }
    
    .dark-pro-shift-mode .btn,
    .dark-pro-shift-mode .filter-btn.active,
    .dark-pro-shift-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(139,92,246,0.3);
    }
    
    .dark-pro-shift-mode .btn:hover,
    .dark-pro-shift-mode .filter-btn.active:hover,
    .dark-pro-shift-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(139,92,246,0.4);
    }
    
    /* Efek untuk Tema Midnight Tech */
    .midnight-tech-mode .fab,
    .midnight-tech-mode .btn,
    .midnight-tech-mode .filter-btn.active,
    .midnight-tech-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(56,189,248,0.3);
    }
    
    .midnight-tech-mode .fab:hover,
    .midnight-tech-mode .btn:hover,
    .midnight-tech-mode .filter-btn.active:hover,
    .midnight-tech-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(56,189,248,0.4);
    }
    
    /* Efek untuk Tema Carbon Blue */
    .carbon-blue-mode .fab,
    .carbon-blue-mode .btn,
    .carbon-blue-mode .filter-btn.active,
    .carbon-blue-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(59,130,246,0.3);
    }
    
    .carbon-blue-mode .fab:hover,
    .carbon-blue-mode .btn:hover,
    .carbon-blue-mode .filter-btn.active:hover,
    .carbon-blue-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(59,130,246,0.4);
    }
    
    /* Efek untuk Tema Cyber Gray */
    .cyber-gray-mode .fab,
    .cyber-gray-mode .btn,
    .cyber-gray-mode .filter-btn.active,
    .cyber-gray-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(34,211,238,0.3);
    }
    
    .cyber-gray-mode .fab:hover,
    .cyber-gray-mode .btn:hover,
    .cyber-gray-mode .filter-btn.active:hover,
    .cyber-gray-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(34,211,238,0.4);
    }
    
    /* Efek untuk Tema Blue Mist */
    .blue-mist-mode .fab,
    .blue-mist-mode .btn,
    .blue-mist-mode .filter-btn.active,
    .blue-mist-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(100,255,218,0.3);
    }
    
    .blue-mist-mode .fab:hover,
    .blue-mist-mode .btn:hover,
    .blue-mist-mode .filter-btn.active:hover,
    .blue-mist-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(100,255,218,0.4);
    }
    
    /* Efek untuk Tema Pink Elegant */
    .pink-elegant-mode .card,
    .pink-elegant-mode .task-card,
    .pink-elegant-mode .schedule-item,
    .pink-elegant-mode .note-card,
    .pink-elegant-mode .stat-card,
    .pink-elegant-mode .form-section,
    .pink-elegant-mode .about-section,
    .pink-elegant-mode .stats-section,
    .pink-elegant-mode header,
    .pink-elegant-mode .calendar-day,
    .pink-elegant-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(236,72,153,0.15),
        inset 0 0 5px rgba(236,72,153,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .pink-elegant-mode .card:hover,
    .pink-elegant-mode .task-card:hover,
    .pink-elegant-mode .schedule-item:hover,
    .pink-elegant-mode .note-card:hover,
    .pink-elegant-mode .stat-card:hover,
    .pink-elegant-mode .form-section:hover,
    .pink-elegant-mode .about-section:hover,
    .pink-elegant-mode .stats-section:hover,
    .pink-elegant-mode header:hover,
    .pink-elegant-mode .calendar-day:hover,
    .pink-elegant-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(236,72,153,0.3),
        inset 0 0 10px rgba(236,72,153,0.1);
    }
    
    .pink-elegant-mode .fab {
      box-shadow: 
        0 18px 40px rgba(236,72,153,0.4),
        0 0 15px rgba(236,72,153,0.2);
    }
    
    .pink-elegant-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(236,72,153,0.6),
        0 0 20px rgba(236,72,153,0.3);
    }
    
    .pink-elegant-mode .btn,
    .pink-elegant-mode .filter-btn.active,
    .pink-elegant-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(236,72,153,0.3);
    }
    
    .pink-elegant-mode .btn:hover,
    .pink-elegant-mode .filter-btn.active:hover,
    .pink-elegant-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(236,72,153,0.4);
    }
    
    /* Logo baru dengan efek neon */
    .logo-neon {
      background: linear-gradient(135deg, #00c8ff, #8B5CF6);
      box-shadow: 0 0 10px rgba(0,200,255,0.5);
      animation: neon-pulse 3s infinite;
    }
    
    @keyframes neon-pulse {
      0%, 100% {
        box-shadow: 0 0 10px rgba(0,200,255,0.5);
      }
      50% {
        box-shadow: 0 0 20px rgba(0,200,255,0.8), 0 0 30px rgba(0,200,255,0.6);
      }
    }
    
    /* Transisi halus untuk semua elemen */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      transition: background-color 0.4s, color 0.4s, box-shadow 0.4s, border-color 0.4s;
    }
    
    html, body {
      height: 100%;
      overflow-x: hidden;
    }
    
    body {
      background: var(--bg);
      min-height: 100vh;
      color: #e6eef8;
      padding: 0;
      -webkit-font-smoothing: antialiased;
      display: flex;
      flex-direction: column;
    }
    
    .light-mode input,
    .light-mode textarea,
    .light-mode select {
      color: #0f1724;
      border-color: rgba(0,0,0,0.1);
      background: rgba(0,0,0,0.02);
    }
    
    /* Container */
    .container {
      max-width: 100%;
      margin: 0 auto;
      padding: 12px;
      width: 100%;
      flex: 1;
      padding-bottom: 80px;
    }
    
    /* Header Styles dengan Optimasi Blur */
    header {
      position: sticky;
      top: 12px;
      z-index: 40;
      margin-bottom: 18px;
      background: linear-gradient(180deg, rgba(30,41,59,0.85), rgba(30,41,59,0.70));
      backdrop-filter: blur(12px) saturate(180%);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      flex-wrap: wrap;
      animation: slideDown 0.5s ease-out;
      transition: backdrop-filter 0.3s ease;
    }
    
    .header-scrolling {
      backdrop-filter: none;
    }
    
    .light-mode header {
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.70));
      border: 1px solid rgba(0,0,0,0.08);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo {
      width: 40px;
      height: 40px;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      background: var(--primary);
      color: #fff;
      flex-shrink: 0;
      animation: pulse 2s infinite;
    }
    
    .logo .app-icon {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      border-radius: 8px;
    }
    
    .brand h1 {
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(135deg, #8B5CF6, #EC4899);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .light-mode .brand h1 {
      background: linear-gradient(135deg, #3B82F6, #2563EB);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .dark-pro-mode .brand h1 {
      background: linear-gradient(135deg, #00c8ff, #0095ff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .dark-pro-shift-mode .brand h1 {
      background: linear-gradient(135deg, #8B5CF6, #7C3AED);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .midnight-tech-mode .brand h1 {
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .carbon-blue-mode .brand h1 {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .cyber-gray-mode .brand h1 {
      background: linear-gradient(135deg, #22d3ee, #06b6d4);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .blue-mist-mode .brand h1 {
      background: linear-gradient(135deg, #64ffda, #48cae4);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .pink-elegant-mode .brand h1 {
      background: linear-gradient(135deg, #ec4899, #db2777);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .header-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.08);
      background: var(--bg-card);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      animation: fadeIn 0.5s ease-out;
    }
    
    .light-mode .icon-btn {
      border-color: rgba(0,0,0,0.08);
      background: var(--card);
    }
    
    .icon-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .icon-btn:active {
      transform: scale(0.95);
    }
    
    /* Menu Drawer */
    .menu-drawer {
      position: fixed;
      top: 0;
      right: -100%;
      width: 85%;
      max-width: 320px;
      height: 100%;
      background: var(--bg-card);
      z-index: 1000;
      transition: right 0.3s ease;
      box-shadow: -5px 0 25px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
      backdrop-filter: blur(10px);
    }
    
    .menu-drawer.open {
      right: 0;
      animation: slideInRight 0.3s ease-out;
    }
    
    @keyframes slideInRight {
      from {
        right: -100%;
        opacity: 0;
      }
      to {
        right: 0;
        opacity: 1;
      }
    }
    
    .menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .light-mode .menu-header {
      border-bottom-color: rgba(0,0,0,0.1);
    }
    
    .menu-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
    }
    
    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s;
      margin-bottom: 8px;
      font-weight: 500;
      animation: fadeIn 0.5s ease-out;
      animation-fill-mode: both;
    }
    
    .menu-item:nth-child(1) { animation-delay: 0.1s; }
    .menu-item:nth-child(2) { animation-delay: 0.15s; }
    .menu-item:nth-child(3) { animation-delay: 0.2s; }
    .menu-item:nth-child(4) { animation-delay: 0.25s; }
    .menu-item:nth-child(5) { animation-delay: 0.3s; }
    .menu-item:nth-child(6) { animation-delay: 0.35s; }
    .menu-item:nth-child(7) { animation-delay: 0.4s; }
    .menu-item:nth-child(8) { animation-delay: 0.45s; }
    .menu-item:nth-child(9) { animation-delay: 0.5s; }
    
    .menu-item:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .light-mode .menu-item:hover {
      background: rgba(0,0,0,0.05);
    }
    
    /* Menu Item untuk Web Utama (Lebih Mencolok) */
    .menu-item-highlight {
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      color: white;
      font-weight: 600;
      box-shadow: 0 0 20px rgba(var(--primary-rgb), 0.4);
    }
    
    .menu-item-highlight:hover {
      background: linear-gradient(135deg, var(--primary-600), var(--primary));
      box-shadow: 0 0 25px rgba(var(--primary-rgb), 0.6);
    }
    
    .menu-divider {
      height: 1px;
      background: rgba(255,255,255,0.1);
      margin: 16px 0;
    }
    
    .light-mode .menu-divider {
      background: rgba(0,0,0,0.1);
    }
    
    /* Profile Section in Menu */
    .profile-section {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      margin-bottom: 20px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .light-mode .profile-section {
      background: rgba(0,0,0,0.05);
      border-bottom-color: rgba(0,0,0,0.1);
    }
    
    .profile-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: white;
      overflow: hidden;
      position: relative;
    }
    
    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .profile-info {
      flex: 1;
    }
    
    .profile-name {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .profile-desc {
      font-size: 12px;
      color: var(--muted);
    }
    
    /* Tab Navigation */
    .tab-navigation {
      display: flex;
      background: rgba(255,255,255,0.05);
      padding: 4px;
      border-radius: 12px;
      margin-bottom: 20px;
      animation: fadeIn 0.6s ease-out;
    }
    
    .light-mode .tab-navigation {
      background: rgba(0,0,0,0.05);
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
      color: var(--muted);
    }
    
    .tab-btn.active {
      background: var(--card);
      box-shadow: var(--shadow);
      color: white;
    }
    
    .light-mode .tab-btn.active {
      color: #0f1724;
    }
    
    .tab-content {
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
      opacity: 1;
      animation: fadeUp 0.5s ease-out;
    }
    
    /* Form & Field Styles */
    .form-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
      backdrop-filter: blur(10px);
    }
    
    .controls {
      display: flex;
      gap: 10px;
    }
    
    .field {
      margin-bottom: 16px;
      position: relative;
    }
    
    .field label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 14px;
    }
    
    .field input,
    .field textarea,
    .field select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: var(--glass);
      font-family: inherit;
      font-size: 15px;
      outline: 0;
      transition: border-color 0.2s, box-shadow 0.2s;
      color: inherit;
    }
    
    .light-mode .field input,
    .light-mode .field textarea,
    .light-mode .field select {
      border-color: rgba(0,0,0,0.1);
    }
    
    .field input:focus,
    .field textarea:focus,
    .field select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.2);
    }
    
    /* Filter Section */
    .filter-section {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
      animation: fadeIn 0.6s ease-out;
    }
    
    .filter-btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.1);
      background: transparent;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--muted);
    }
    
    .light-mode .filter-btn {
      border-color: rgba(0,0,0,0.1);
    }
    
    .filter-btn.active,
    .filter-btn:hover {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
      transform: translateY(-2px);
    }
    
    /* Task Card */
    .task-card {
      background: var(--card);
      padding: 18px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 16px;
      position: relative;
      border-left: 4px solid transparent;
      transition: all 0.2s ease;
      overflow: hidden;
      animation: fadeUp 0.5s ease-out;
      backdrop-filter: blur(5px);
      cursor: move;
    }
    
    .task-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.25);
    }
    
    .task-card.dragging {
      opacity: 0.5;
      transform: rotate(5deg);
    }
    
    .task-title {
      font-weight: 700;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }
    
    /* Priority indicator (new) */
    .priority-indicator {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      display: inline-block;
      flex-shrink: 0;
      margin-right: 8px;
      line-height: 14px;
      text-align: center;
      font-size: 12px;
    }
    
    .priority-high-indicator { 
      background: var(--priority-high); 
    }
    .priority-medium-indicator { background: var(--priority-medium); }
    .priority-low-indicator { background: var(--priority-low); }
    
    .task-title .title-text {
      display: inline-block;
      overflow-wrap: anywhere;
      word-break: break-word;
      white-space: normal;
      flex: 1;
    }
    
    .task-detail {
      font-size: 14px;
      color: var(--muted);
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 8px;
      word-break: break-word;
    }
    
    .task-detail .long-text {
      max-height: 120px;
      overflow-y: auto;
      padding-right: 6px;
    }
    
    .task-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.05);
    }
    
    .light-mode .task-actions {
      border-top-color: rgba(0,0,0,0.05);
    }
    
    .status-pill {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 12px;
      z-index: 30;
      pointer-events: none;
      white-space: nowrap;
    }
    
    /* Priority and deadline classes */
    .priority-high { border-left-color: var(--priority-high); }
    .priority-medium { border-left-color: var(--priority-medium); }
    .priority-low { border-left-color: var(--priority-low); }
    .dl-ok { border-left-color: var(--success); }
    .dl-soon { border-left-color: var(--warning); }
    .dl-urgent { border-left-color: var(--danger); }
    .dl-overdue { border-left-color: #6b7280; opacity: 0.85; }
    
    /* Priority badge kept for compatibility but not used visually by default */
    .priority-badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      margin-left: auto;
    }
    
    .priority-high-badge { background-color: var(--priority-high); color: white; }
    .priority-medium-badge { background-color: var(--priority-medium); color: white; }
    .priority-low-badge { background-color: var(--priority-low); color: white; }
    
    /* FAB */
    .fab {
      position: fixed;
      right: 20px;
      bottom: calc(20px + env(safe-area-inset-bottom));
      width: 60px;
      height: 60px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 24px;
      box-shadow: 0 18px 40px rgba(var(--primary-rgb), 0.3);
      cursor: pointer;
      border: 0;
      z-index: 60;
      transition: all 0.2s ease;
      animation: pulse 2s infinite;
    }
    
    .fab:hover {
      transform: scale(1.05);
      box-shadow: 0 20px 45px rgba(var(--primary-rgb), 0.4);
    }
    
    .fab:active {
      transform: scale(0.95);
    }
    
    /* Toast */
    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 100px;
      background: var(--toast-bg);
      color: var(--toast-text);
      padding: 12px 18px;
      border-radius: 10px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s;
      z-index: 80;
      font-size: 14px;
      text-align: center;
      max-width: 80%;
      box-shadow: var(--shadow);
    }
    
    .toast.show {
      opacity: 1;
      pointer-events: auto;
      animation: slideUp 0.3s ease-out;
    }
    
    /* Watermark */
    .watermark {
      position: fixed;
      left: 12px;
      bottom: 12px;
      font-size: 12px;
      color: var(--muted);
      opacity: 0.28;
      pointer-events: none;
      z-index: 70;
      background: transparent;
      padding: 4px 6px;
      border-radius: 8px;
    }
    
    .light-mode .watermark {
      opacity: 0.18;
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
      animation: fadeIn 0.6s ease-out;
    }
    
    .empty-state h3 {
      margin-bottom: 8px;
    }
    
    /* Button Styles */
    .btn {
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      color: #fff;
      padding: 12px 18px;
      border-radius: 10px;
      border: 0;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(var(--primary-rgb), 0.4);
    }
    
    .btn:active {
      transform: scale(0.98);
    }
    
    /* Schedule styles */
    .schedule-day {
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
    }
    
    .schedule-header {
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    
    .light-mode .schedule-header {
      border-bottom-color: rgba(0,0,0,0.06);
    }
    
    .schedule-item {
      background: var(--card);
      padding: 14px;
      border-radius: 10px;
      margin-bottom: 10px;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s ease;
    }
    
    .schedule-item:hover {
      transform: translateY(-2px);
    }
    
    .schedule-time {
      font-weight: 600;
      color: var(--primary);
      min-width: 80px;
    }
    
    .schedule-subject {
      font-weight: 600;
      flex: 1;
      margin: 0 12px;
    }
    
    /* About page styles */
    .about-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }
    
    .about-logo {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .about-logo .logo {
      width: 80px;
      height: 80px;
      font-size: 36px;
      margin: 0 auto 16px;
      padding: 6px;
    }
    
    .about-logo .logo .app-icon {
      border-radius: 12px;
    }
    
    .feature-list {
      margin: 16px 0;
      padding-left: 20px;
    }
    
    .feature-list li {
      margin-bottom: 8px;
    }
    
    .version-info {
      text-align: center;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid rgba(255,255,255,0.06);
    }
    
    .light-mode .version-info {
      border-top-color: rgba(0,0,0,0.06);
    }
    
    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      backdrop-filter: blur(5px);
    }
    
    .modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }
    
    .modal {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      max-width: 90%;
      width: 400px;
      max-height: 80%;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      animation: modalSlideIn 0.3s ease-out;
      backdrop-filter: blur(10px);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      transition: transform 0.2s;
    }
    
    .modal-close:hover {
      transform: scale(1.1);
    }
    
    /* Badge for task count - PERBAIKAN POSISI */
    .badge {
      position: absolute;
      top: -8px;
      right: -8px;
      min-width: 20px;
      height: 20px;
      border-radius: 999px;
      background: var(--danger);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 12px;
      box-shadow: 0 2px 6px rgba(239,68,68,0.3);
      z-index: 10;
    }
    
    /* Theme Selection Modal */
    .theme-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 8px;
    }
    
    .theme-option:hover {
      background: rgba(255,255,255,0.05);
      transform: translateX(5px);
    }
    
    .light-mode .theme-option:hover {
      background: rgba(0,0,0,0.05);
    }
    
    .theme-preview {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    /* Notes styles */
    .note-card {
      background: var(--card);
      padding: 18px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 16px;
      position: relative;
      transition: all 0.2s ease;
      animation: fadeUp 0.5s ease-out;
    }
    
    .note-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.25);
    }
    
    .note-title {
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 8px;
      word-break: break-word;
    }
    
    .note-content {
      font-size: 14px;
      margin-bottom: 12px;
      word-break: break-word;
      white-space: pre-wrap;
      color: var(--muted);
      max-height: 160px;
      overflow-y: auto;
    }
    
    .note-meta {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 12px;
    }
    
    .note-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }
    
    /* Stats Modal Styles - DIPERBAIKI */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .stat-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      box-shadow: var(--shadow);
      transition: all 0.2s ease;
      backdrop-filter: blur(5px);
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--primary);
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 25px rgba(0,0,0,0.2);
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 4px;
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .stat-label {
      font-size: 14px;
      color: var(--muted);
    }
    
    /* Chart container - DIPERBAIKI */
    .chart-wrap {
      margin-top: 20px;
      background: transparent;
      border-radius: var(--radius);
      padding: 16px;
      background: var(--bg-card);
    }
    
    .chart-container {
      width: 100%;
      height: 220px;
      position: relative;
    }
    
    /* Stats Section on Home - DIPERBAIKI */
    .stats-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
      backdrop-filter: blur(5px);
    }
    
    .stats-section h3 {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Profile Modal Styles - DIPERBAIKI */
    .profile-modal .avatar-options {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 16px 0;
    }
    
    .avatar-option {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }
    
    .avatar-option:hover {
      transform: scale(1.1);
    }
    
    .avatar-option.selected {
      border-color: var(--primary);
      box-shadow: 0 0 10px var(--primary);
    }
    
    .profile-modal .upload-btn {
      display: block;
      width: 100%;
      padding: 12px;
      margin: 16px 0;
      border-radius: 10px;
      background: rgba(255,255,255,0.05);
      border: 1px dashed rgba(255,255,255,0.2);
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .light-mode .profile-modal .upload-btn {
      background: rgba(0,0,0,0.05);
      border-color: rgba(0,0,0,0.2);
    }
    
    .profile-modal .upload-btn:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .light-mode .profile-modal .upload-btn:hover {
      background: rgba(0,0,0,0.1);
    }
    
    .profile-modal .actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .profile-modal .actions .btn {
      flex: 1;
    }
    
    /* Crop Modal Styles - Redesigned untuk crop 1:1 */
    .crop-modal .crop-container {
      width: 100%;
      height: 300px;
      margin: 16px 0;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .crop-modal .crop-area {
      position: absolute;
      border: 2px solid var(--primary);
      box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
      cursor: move;
      z-index: 10;
    }
    
    .crop-modal .crop-handle {
      position: absolute;
      width: 12px;
      height: 12px;
      background: var(--primary);
      border-radius: 50%;
      z-index: 11;
    }
    
    .crop-modal .crop-handle.nw { top: -6px; left: -6px; cursor: nw-resize; }
    .crop-modal .crop-handle.ne { top: -6px; right: -6px; cursor: ne-resize; }
    .crop-modal .crop-handle.sw { bottom: -6px; left: -6px; cursor: sw-resize; }
    .crop-modal .crop-handle.se { bottom: -6px; right: -6px; cursor: se-resize; }
    
    .crop-modal .crop-preview {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin: 16px auto;
      overflow: hidden;
      border: 2px solid var(--primary);
      box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .crop-modal .crop-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .crop-modal .crop-controls {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }
    
    .crop-modal .crop-controls .btn {
      flex: 1;
    }
    
    .crop-modal .crop-size-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 12px;
    }
    
    .crop-modal .size-slider {
      flex: 1;
      -webkit-appearance: none;
      height: 6px;
      border-radius: 3px;
      background: rgba(255,255,255,0.1);
      outline: none;
    }
    
    .crop-modal .size-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
    }
    
    .crop-modal .size-value {
      min-width: 40px;
      text-align: center;
      font-size: 14px;
      color: var(--muted);
    }

    /* Profile Card Styles - DIPERBAIKI */
    .profile-card {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .avatar-wrap {
      position: relative;
      display: inline-block;
      margin-bottom: 16px;
    }
    
    .avatar-img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--primary);
      box-shadow: 0 0 20px rgba(var(--primary-rgb), 0.4);
    }
    
    .avatar-change-btn {
      position: absolute;
      bottom: 5px;
      right: 5px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--primary);
      border: 2px solid var(--bg-card);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s;
    }
    
    .avatar-change-btn:hover {
      transform: scale(1.1);
      background: var(--primary-600);
    }
    
    .profile-display-name {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .profile-display-bio {
      color: var(--muted);
      font-size: 16px;
      max-width: 300px;
      margin: 0 auto;
    }

    /* Mode Lite untuk perangkat rendah */
    .lite-mode * {
      animation: none !important;
      transition: none !important;
    }

    .lite-mode .logo-neon {
      animation: none !important;
    }

    .lite-mode header {
      backdrop-filter: none !important;
      background: linear-gradient(180deg, rgba(30,41,59,0.95), rgba(30,41,59,0.90)) !important;
    }

    .lite-mode .modal {
      backdrop-filter: none !important;
    }

    .lite-mode .menu-drawer {
      backdrop-filter: none !important;
    }

    .lite-mode .form-section,
    .lite-mode .stats-section,
    .lite-mode .about-section {
      backdrop-filter: none !important;
    }

    .lite-mode .task-card,
    .lite-mode .schedule-item,
    .lite-mode .note-card,
    .lite-mode .stat-card {
      backdrop-filter: none !important;
    }

    /* Untuk tema terang */
    .lite-mode.light-mode header {
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.90)) !important;
    }

    /* Calendar Styles */
    .calendar-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }
    
    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background: var(--bg-card);
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      padding: 4px;
    }
    
    .calendar-day:hover {
      background: var(--primary);
      color: white;
    }
    
    .calendar-day.today {
      background: var(--primary);
      color: white;
      box-shadow: 0 0 10px var(--primary);
    }
    
    .calendar-day.has-task::after {
      content: '';
      position: absolute;
      bottom: 4px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--success);
    }
    
    .calendar-day.has-overdue::after {
      background: var(--danger);
    }
    
    .calendar-day-header {
      font-weight: 600;
      text-align: center;
      margin-bottom: 8px;
      color: var(--muted);
    }
    
    /* Productivity Card Styles */
    .productivity-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
    }
    
    .pomodoro-timer {
      text-align: center;
      margin: 20px 0;
    }
    
    .timer-display {
      font-size: 48px;
      font-weight: 700;
      margin: 20px 0;
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .timer-controls {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    
    .timer-mode {
      display: flex;
      background: var(--bg-card);
      border-radius: 12px;
      padding: 4px;
      margin: 16px 0;
    }
    
    .timer-mode-btn {
      flex: 1;
      padding: 8px;
      border: none;
      background: transparent;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .timer-mode-btn.active {
      background: var(--primary);
      color: white;
    }
    
    /* Timer Settings Styles */
    .timer-settings {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    
    .timer-settings h4 {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .timer-settings .field {
      margin-bottom: 12px;
    }
    
    .timer-settings .field label {
      font-size: 14px;
      margin-bottom: 4px;
    }
    
    .timer-settings .field input {
      padding: 8px 12px;
      font-size: 14px;
    }
    
    /* Search Section */
    .search-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
    }
    
    .search-input {
      width: 100%;
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: var(--glass);
      font-family: inherit;
      font-size: 15px;
      outline: 0;
      color: inherit;
    }
    
    /* Progress Bar */
    .progress-bar {
      height: 8px;
      background: var(--bg-card);
      border-radius: 4px;
      overflow: hidden;
      margin: 12px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--primary-600));
      border-radius: 4px;
      transition: width 0.3s ease;
    }
    
    /* Animations */
    @keyframes slideDown {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    @keyframes fadeUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    @keyframes slideUp {
      from {
        transform: translate(-50%, 20px);
        opacity: 0;
      }
      to {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }
    
    @keyframes modalSlideIn {
      from {
        transform: scale(0.9);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }
    
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(var(--primary-rgb), 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(var(--primary-rgb), 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(var(--primary-rgb), 0);
      }
    }

    /* Settings Modal Styles */
    .setting-group {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .setting-group h4 {
      margin-bottom: 12px;
      font-weight: 600;
    }
    
    .setting-group .field {
      margin-bottom: 12px;
    }
    
    .setting-group .field label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    
    .setting-group .field input[type="checkbox"] {
      width: auto;
    }
    
    /* Tips Modal Styles */
    .tips-content {
      line-height: 1.6;
    }
    
    .tip-item {
      margin-bottom: 16px;
      padding: 12px;
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
    }
    
    .tip-item h4 {
      margin-bottom: 8px;
      color: var(--primary);
    }
    
    /* Note Color Styles */
    .note-red { border-left: 4px solid #ef4444; }
    .note-blue { border-left: 4px solid #3b82f6; }
    .note-green { border-left: 4px solid #10b981; }
    .note-yellow { border-left: 4px solid #f59e0b; }
    .note-purple { border-left: 4px solid #8b5cf6; }
    
    /* Notification Modal Styles */
    .notification-item {
      padding: 12px;
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .notification-item.unread {
      background: rgba(var(--primary-rgb), 0.1);
      border-left: 3px solid var(--primary);
    }
    
    .notification-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }
    
    .notification-content {
      flex: 1;
    }
    
    .notification-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .notification-time {
      font-size: 12px;
      color: var(--muted);
    }
    
    /* PRO Dashboard Styles */
    .pro-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .pro-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      animation: fadeUp 0.5s ease-out;
      backdrop-filter: blur(5px);
    }
    
    .pro-card h3 {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .pro-badge {
      background: linear-gradient(135deg, #FFD700, #D4AF37);
      color: #000;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 700;
      margin-left: 8px;
    }
    
    /* Habit Tracker Styles */
    .habit-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-top: 16px;
    }
    
    .habit-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background: var(--bg-card);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .habit-day.completed {
      background: var(--success);
      color: white;
    }
    
    .habit-day.skipped {
      background: var(--muted);
      opacity: 0.5;
    }
    
    /* Voice Notes Styles */
    .voice-note-card {
      background: var(--card);
      padding: 18px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 16px;
      position: relative;
      transition: all 0.2s ease;
      animation: fadeUp 0.5s ease-out;
    }
    
    .voice-note-player {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 12px 0;
    }
    
    .voice-play-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      border: none;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .voice-play-btn:hover {
      transform: scale(1.05);
    }
    
    .voice-progress {
      flex: 1;
      height: 6px;
      background: var(--bg-card);
      border-radius: 3px;
      overflow: hidden;
      position: relative;
    }
    
    .voice-progress-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 3px;
      transition: width 0.1s;
    }
    
    .voice-duration {
      font-size: 12px;
      color: var(--muted);
      min-width: 40px;
      text-align: center;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .header-actions {
        position: relative;
      }
      
      .brand h1 {
        font-size: 18px;
      }
      
      .logo {
        width: 36px;
        height: 36px;
      }
      
      .btn, .filter-btn {
        padding: 10px 14px;
        font-size: 13px;
      }
      
      .task-title {
        font-size: 16px;
      }
      
      .task-detail {
        font-size: 13px;
      }
      
      .fab {
        width: 56px;
        height: 56px;
        font-size: 22px;
        bottom: 80px;
      }
      
      .priority-badge {
        font-size: 10px;
        padding: 3px 6px;
      }
      
      .task-actions {
        flex-wrap: wrap;
      }
      
      .menu-drawer {
        width: 85%;
      }
      
      .timer-display {
        font-size: 36px;
      }

      /* Mobile optimization - reduce blur effects */
      header {
        backdrop-filter: none !important;
        background: linear-gradient(180deg, rgba(30,41,59,0.95), rgba(30,41,59,0.90)) !important;
      }

      .light-mode header {
        background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.90)) !important;
      }

      .modal {
        backdrop-filter: none !important;
      }

      .menu-drawer {
        backdrop-filter: none !important;
      }

      .form-section,
      .stats-section,
      .about-section {
        backdrop-filter: none !important;
      }

      .task-card,
      .schedule-item,
      .note-card,
      .stat-card {
        backdrop-filter: none !important;
      }

      /* Tab navigation scrollable on mobile */
      .tab-navigation {
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none; /* Firefox */
      }
      
      .tab-navigation::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Edge */
      }
      
      .tab-btn {
        flex: none;
        min-width: 100px;
      }
      
      .pro-dashboard {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 480px) {
      .brand {
        gap: 8px;
      }
      
      .header-actions {
        justify-content: flex-end;
        width: 100%;
        margin-top: 8px;
      }
      
      .controls {
        justify-content: space-between;
        width: 100%;
      }
      
      .filter-section {
        gap: 6px;
      }
      
      .filter-btn {
        padding: 8px 12px;
        font-size: 13px;
      }
      
      .schedule-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .schedule-time {
        min-width: auto;
      }
      
      .task-title {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }
      
      .priority-badge {
        margin-left: 0;
      }
      
      .task-detail {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }
      
      .note-title, .note-content {
        word-break: break-word;
      }
      
      .chart-container {
        height: 180px !important;
      }
      
      .menu-drawer {
        width: 90%;
      }

      .avatar-img {
        width: 100px;
        height: 100px;
      }

      .profile-display-name {
        font-size: 20px;
      }

      .profile-display-bio {
        font-size: 14px;
      }
      
      .calendar-grid {
        gap: 4px;
      }
      
      .timer-display {
        font-size: 32px;
      }
      
      .voice-note-player {
        flex-direction: column;
        gap: 8px;
      }
      
      .voice-progress {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash" style="position:fixed;inset:0;z-index:9999;background:#000;display:flex;align-items:center;justify-content:center;">
    <img src="splash.png" alt="Splash" style="width:100%;height:100%;object-fit:cover;">
  </div>

  <!-- Main Content -->
  <div id="mainContent" style="display:none;">
    <div class="container">
      <!-- Header -->
      <header>
        <div class="brand">
          <div class="logo logo-neon">
            <img src="my-icon.png" alt="App Icon" class="app-icon">
          </div>
          <h1>TugasKu3 <span class="pro-badge">PRO</span></h1>
        </div>
        <div class="header-actions">
          <!-- Notifikasi - DIPERBAIKI -->
          <button class="icon-btn" id="notifBtn" title="Notifikasi" aria-label="Notifikasi" style="position:relative;">
            
            <span class="badge" id="notifBadge" style="display:none;">0</span>
          </button>
          <!-- Statistik -->
          <button class="icon-btn" id="statsBtn" title="Statistik" aria-label="Statistik"></button>
          <!-- Menu Hamburger -->
          <button class="icon-btn" id="menuBtn" title="Menu" aria-label="Menu">
            <svg width="24" height="24" stroke="currentColor" fill="none">
              <path d="M3 6h18M3 12h18M3 18h18"/>
            </svg>
          </button>
        </div>
      </header>
      
      <!-- Menu Drawer -->
      <div class="menu-drawer" id="menuDrawer">
        <div class="menu-header">
          <h3>Menu PRO</h3>
          <button class="menu-close" id="menuClose">&times;</button>
        </div>
        
        <!-- Profile Section -->
        <div class="profile-section" id="profileSection">
          <div class="profile-avatar" id="profileAvatar"></div>
          <div class="profile-info">
            <div class="profile-name" id="profileName">Pengguna TugasKu</div>
            <div class="profile-desc" id="profileDesc">Pelajar Aktif</div>
          </div>
        </div>
        
        <div class="menu-divider"></div>
        
        <!-- Menu Items - Web Utama dipindah ke sini dengan gaya mencolok -->
        <div class="menu-item menu-item-highlight" data-action="portfolio" title="Kunjungi Portofolio Rahmat">
          <span>&lt;/&gt;</span> Kunjungi Web Utama
        </div>
        
        <div class="menu-divider"></div>
        
        <div class="menu-item" data-action="profile">
          <span></span> Profil Saya
        </div>
        <div class="menu-item" data-action="settings">
          <span></span> Pengaturan
        </div>
        <div class="menu-item" data-action="tips">
          <span></span> Tips & Panduan
        </div>
        <div class="menu-item" data-action="focus">
          <span></span> Mode Fokus
        </div>
        <div class="menu-item" data-action="backup">
          <span></span> Cadangan Otomatis
        </div>
        
        <div class="menu-divider"></div>
        
        <div class="menu-item" data-action="export">
          <span></span> Ekspor Data
        </div>
        <div class="menu-item" data-action="import">
          <span></span> Impor Data
        </div>
        
        <div class="menu-divider"></div>
        
        <div class="menu-item" data-action="theme">
          <span></span> Pilih Tema
        </div>
        <div class="menu-item" data-action="about">
          <span></span> Tentang Aplikasi
        </div>
        <div class="menu-item" data-action="reset">
          <span></span> Reset Data
        </div>
      </div>
      
      <!-- Tab Navigation -->
      <div class="tab-navigation">
        <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
        <button class="tab-btn" data-tab="tasks">Tugas</button>
        <button class="tab-btn" data-tab="schedule">Jadwal</button>
        <button class="tab-btn" data-tab="notes">Catatan</button>
        <button class="tab-btn" data-tab="calendar">Kalender</button>
        <button class="tab-btn" data-tab="productivity">Produktivitas</button>
      </div>
      
      <!-- Tab Content: Dashboard PRO -->
      <div class="tab-content active" id="dashboardTab">
        <div class="pro-dashboard">
          <!-- Statistik Cepat -->
          <div class="pro-card">
            <h3> Ringkasan Produktivitas</h3>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="dashboardTotalTasks">0</div>
                <div class="stat-label">Total Tugas</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="dashboardCompleted">0</div>
                <div class="stat-label">Selesai</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="dashboardFocusTime">0</div>
                <div class="stat-label">Jam Fokus</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="dashboardProductivity">0%</div>
                <div class="stat-label">Produktivitas</div>
              </div>
            </div>
          </div>
          
          <!-- Tugas Mendesak -->
          <div class="pro-card">
            <h3> Tugas Mendesak</h3>
            <div id="urgentTasksList">
              <div class="empty-state">
                <p>Tidak ada tugas mendesak</p>
              </div>
            </div>
          </div>
          
          <!-- Aktivitas Terbaru -->
          <div class="pro-card">
            <h3> Aktivitas Terbaru</h3>
            <div class="chart-wrap">
              <div class="chart-container">
                <canvas id="dashboardActivityChart"></canvas>
              </div>
            </div>
          </div>
          
          <!-- Pencapaian -->
          <div class="pro-card">
            <h3> Pencapaian</h3>
            <div id="achievementsList">
              <div class="empty-state">
                <p>Belum ada pencapaian</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tab Content: Tugas -->
      <div class="tab-content" id="tasksTab">
        <!-- Stats Section - DIPERBAIKI -->
        <section class="stats-section">
          <h3> Statistik Tugas</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="totalTasksHome">0</div>
              <div class="stat-label">Total Tugas</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="completedTasksHome">0</div>
              <div class="stat-label">Selesai</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="pendingTasksHome">0</div>
              <div class="stat-label">Belum Selesai</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="overdueTasksHome">0</div>
              <div class="stat-label">Terlambat</div>
            </div>
          </div>
          <div class="chart-wrap">
            <div class="chart-container">
              <canvas id="homeTaskChart"></canvas>
            </div>
          </div>
        </section>
        
        <!-- Filter Section -->
        <div class="filter-section">
          <button class="filter-btn active" data-filter="all">Semua</button>
          <button class="filter-btn" data-filter="pending">Belum Selesai</button>
          <button class="filter-btn" data-filter="completed">Selesai</button>
          <button class="filter-btn" data-filter="overdue">Terlambat</button>
          <button class="filter-btn" data-filter="high">Prioritas Tinggi</button>
          <button class="filter-btn" data-filter="today">Hari Ini</button>
        </div>
        
        <!-- Search Section -->
        <div class="search-section">
          <input type="text" class="search-input" id="taskSearch" placeholder="Cari tugas...">
        </div>
        
        <!-- Tasks List -->
        <div id="tasksList">
          <div class="empty-state">
            <h3>Belum ada tugas</h3>
            <p>Tambahkan tugas pertama Anda dengan tombol + di bawah</p>
          </div>
        </div>
      </div>
      
      <!-- Tab Content: Jadwal -->
      <div class="tab-content" id="scheduleTab">
        <div class="form-section">
          <h3>Tambah Jadwal</h3>
          <div class="field">
            <label>Hari</label>
            <select id="scheduleDay">
              <option value="senin">Senin</option>
              <option value="selasa">Selasa</option>
              <option value="rabu">Rabu</option>
              <option value="kamis">Kamis</option>
              <option value="jumat">Jumat</option>
              <option value="sabtu">Sabtu</option>
              <option value="minggu">Minggu</option>
            </select>
          </div>
          <div class="field">
            <label>Waktu</label>
            <input type="time" id="scheduleTime">
          </div>
          <div class="field">
            <label>Mata Pelajaran/Kegiatan</label>
            <input type="text" id="scheduleSubject" placeholder="Contoh: Matematika">
          </div>
          <div class="field">
            <label>Deskripsi</label>
            <textarea id="scheduleDesc" rows="2" placeholder="Opsional"></textarea>
          </div>
          <div class="controls">
            <button class="btn" id="addScheduleBtn">Tambah Jadwal</button>
          </div>
        </div>
        
        <div id="scheduleList">
          <div class="empty-state">
            <h3>Belum ada jadwal</h3>
            <p>Tambahkan jadwal mingguan Anda</p>
          </div>
        </div>
      </div>
      
      <!-- Tab Content: Catatan -->
      <div class="tab-content" id="notesTab">
        <div class="form-section">
          <h3>Tambah Catatan</h3>
          <div class="field">
            <label>Judul</label>
            <input type="text" id="noteTitle" placeholder="Judul catatan">
          </div>
          <div class="field">
            <label>Isi</label>
            <textarea id="noteContent" rows="5" placeholder="Tulis catatan Anda di sini..."></textarea>
          </div>
          <div class="field">
            <label>Warna</label>
            <select id="noteColor">
              <option value="">Default</option>
              <option value="red">Merah</option>
              <option value="blue">Biru</option>
              <option value="green">Hijau</option>
              <option value="yellow">Kuning</option>
              <option value="purple">Ungu</option>
            </select>
          </div>
          <div class="field">
            <label>
              <input type="checkbox" id="notePinned"> Pin catatan (tampilkan di atas)
            </label>
          </div>
          <div class="controls">
            <button class="btn" id="addNoteBtn">Tambah Catatan</button>
          </div>
        </div>
        
        <div id="notesList">
          <div class="empty-state">
            <h3>Belum ada catatan</h3>
            <p>Tambahkan catatan pertama Anda</p>
          </div>
        </div>
      </div>
      
      <!-- Tab Content: Kalender -->
      <div class="tab-content" id="calendarTab">
        <div class="calendar-section">
          <div class="calendar-header">
            <button class="icon-btn" id="prevMonth"></button>
            <h3 id="currentMonth">Januari 2023</h3>
            <button class="icon-btn" id="nextMonth"></button>
          </div>
          <div class="calendar-grid" id="calendarGrid">
            <!-- Calendar will be generated by JavaScript -->
          </div>
        </div>
        
        <div class="form-section">
          <h3>Tugas untuk <span id="selectedDate">-</span></h3>
          <div id="selectedDateTasks">
            <p>Pilih tanggal untuk melihat tugas</p>
          </div>
        </div>
      </div>
      
      <!-- Tab Content: Produktivitas -->
      <div class="tab-content" id="productivityTab">
        <div class="productivity-card">
          <h3> Fokus Timer PRO</h3>
          <div class="timer-mode">
            <button class="timer-mode-btn active" data-mode="focus">Fokus</button>
            <button class="timer-mode-btn" data-mode="short">Istirahat Pendek</button>
            <button class="timer-mode-btn" data-mode="long">Istirahat Panjang</button>
          </div>
          <div class="pomodoro-timer">
            <div class="timer-display" id="timerDisplay">25:00</div>
            <div class="timer-controls">
              <button class="btn" id="startTimer">Mulai</button>
              <button class="btn" id="pauseTimer">Jeda</button>
              <button class="btn" id="resetTimer">Reset</button>
            </div>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="timerProgress" style="width: 0%"></div>
          </div>
          
          <!-- Pengaturan Timer Langsung -->
          <div class="timer-settings">
            <h4> Pengaturan Timer</h4>
            <div class="field">
              <label>Durasi Fokus (menit):</label>
              <input type="number" id="focusDurationSetting" min="1" placeholder="Masukkan menit">
            </div>
            <div class="field">
              <label>Durasi Istirahat Pendek (menit):</label>
              <input type="number" id="shortBreakDurationSetting" min="1" placeholder="Masukkan menit">
            </div>
            <div class="field">
              <label>Durasi Istirahat Panjang (menit):</label>
              <input type="number" id="longBreakDurationSetting" min="1" placeholder="Masukkan menit">
            </div>
            <button class="btn" id="saveTimerSettings">Simpan Pengaturan Timer</button>
          </div>
        </div>
        
        <div class="stats-section">
          <h3> Statistik Produktivitas PRO</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="todayPomodoros">0</div>
              <div class="stat-label">Fokus Hari Ini</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="weekPomodoros">0</div>
              <div class="stat-label">Fokus Minggu Ini</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="totalPomodoros">0</div>
              <div class="stat-label">Total Fokus</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="focusTime">0</div>
              <div class="stat-label">Jam Fokus</div>
            </div>
          </div>
          <div class="chart-wrap">
            <div class="chart-container">
              <canvas id="productivityChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- FAB -->
    <button class="fab" id="addTaskBtn">+</button>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>
    
    <!-- Watermark -->
    <div class="watermark">TugasKu3 PRO v5.0.0</div>
  </div>
  
  <!-- Task Modal -->
  <div class="modal-overlay" id="taskModal">
    <div class="modal">
      <div class="modal-header">
        <h3 id="taskModalTitle">Tambah Tugas Baru</h3>
        <button class="modal-close" id="taskModalClose">&times;</button>
      </div>
      <form id="taskForm">
        <div class="field">
          <label>Judul Tugas</label>
          <input type="text" id="taskTitle" required placeholder="Contoh: Mengerjakan PR Matematika">
        </div>
        <div class="field">
          <label>Deskripsi</label>
          <textarea id="taskDesc" rows="3" placeholder="Detail tugas (opsional)"></textarea>
        </div>
        <div class="field">
          <label>Deadline</label>
          <input type="date" id="taskDeadline">
        </div>
        <div class="field">
          <label>Prioritas</label>
          <select id="taskPriority">
            <option value="low">Rendah</option>
            <option value="medium" selected>Sedang</option>
            <option value="high">Tinggi</option>
          </select>
        </div>
        <div class="field">
          <label>Kategori</label>
          <input type="text" id="taskCategory" placeholder="Contoh: Sekolah, Pribadi">
        </div>
        <div class="controls">
          <button type="button" class="btn" id="cancelTaskBtn">Batal</button>
          <button type="submit" class="btn" id="saveTaskBtn">Simpan</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Stats Modal -->
  <div class="modal-overlay" id="statsModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Statistik Lengkap PRO</h3>
        <button class="modal-close" id="statsModalClose">&times;</button>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalTasks">0</div>
          <div class="stat-label">Total Tugas</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="completedTasks">0</div>
          <div class="stat-label">Selesai</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="pendingTasks">0</div>
          <div class="stat-label">Belum Selesai</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="overdueTasks">0</div>
          <div class="stat-label">Terlambat</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="todayTasks">0</div>
          <div class="stat-label">Tugas Hari Ini</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="weekTasks">0</div>
          <div class="stat-label">Tugas Minggu Ini</div>
        </div>
      </div>
      <div class="chart-wrap">
        <div class="chart-container">
          <canvas id="taskChart"></canvas>
        </div>
      </div>
      <div class="chart-wrap">
        <div class="chart-container">
          <canvas id="priorityChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Theme Modal -->
  <div class="modal-overlay" id="themeModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Pilih Tema PRO</h3>
        <button class="modal-close" id="themeModalClose">&times;</button>
      </div>
      <div class="theme-option" data-theme="dark">
        <div class="theme-preview" style="background: #1e293b; color: white;"></div>
        <div>
          <div>Gelap Standar</div>
          <small>Tema gelap dengan aksen ungu</small>
        </div>
      </div>
      <div class="theme-option" data-theme="light">
        <div class="theme-preview" style="background: #ffffff; color: #333;"></div>
        <div>
          <div>Terang</div>
          <small>Tema terang yang nyaman di mata</small>
        </div>
      </div>
      <div class="theme-option" data-theme="dark-pro">
        <div class="theme-preview" style="background: #0b0f16; color: #00c8ff;"></div>
        <div>
          <div>Gelap Profesional</div>
          <small>Tema gelap dengan aksen biru neon</small>
        </div>
      </div>
      <div class="theme-option" data-theme="dark-pro-shift">
        <div class="theme-preview" style="background: #0f172a; color: #8B5CF6;"></div>
        <div>
          <div>Gelap Profesional Shift</div>
          <small>Tema gelap dengan aksen ungu neon</small>
        </div>
      </div>
      <div class="theme-option" data-theme="midnight-tech">
        <div class="theme-preview" style="background: #0f172a; color: #38bdf8;"></div>
        <div>
          <div>Midnight Tech</div>
          <small>Tema gelap dengan aksen biru techy</small>
        </div>
      </div>
      <div class="theme-option" data-theme="carbon-blue">
        <div class="theme-preview" style="background: #1e293b; color: #3b82f6;"></div>
        <div>
          <div>Carbon Blue</div>
          <small>Tema gelap dengan aksen biru elegan</small>
        </div>
      </div>
      <div class="theme-option" data-theme="cyber-gray">
        <div class="theme-preview" style="background: #111827; color: #22d3ee;"></div>
        <div>
          <div>Cyber Gray</div>
          <small>Tema futuristic dengan aksen cyan</small>
        </div>
      </div>
      <div class="theme-option" data-theme="blue-mist">
        <div class="theme-preview" style="background: #0a192f; color: #64ffda;"></div>
        <div>
          <div>Blue Mist</div>
          <small>Tema gelap dengan aksen hijau kebiruan</small>
        </div>
      </div>
      <div class="theme-option" data-theme="pink-elegant">
        <div class="theme-preview" style="background: #2d1b3e; color: #ec4899;"></div>
        <div>
          <div>Pink Elegant</div>
          <small>Tema elegan dengan aksen pink untuk wanita</small>
        </div>
      </div>
      <div class="theme-option" data-theme="pro-gold">
        <div class="theme-preview" style="background: #2d2d2d; color: #FFD700;"></div>
        <div>
          <div>PRO Gold</div>
          <small>Tema premium dengan aksen emas</small>
        </div>
      </div>
      <div class="theme-option" data-theme="pro-deep-ocean">
        <div class="theme-preview" style="background: #001219; color: #00B4D8;"></div>
        <div>
          <div>PRO Deep Ocean</div>
          <small>Tema dalam laut dengan aksen biru</small>
        </div>
      </div>
      <div class="theme-option" data-theme="pro-forest">
        <div class="theme-preview" style="background: #1a2f1a; color: #2A9D8F;"></div>
        <div>
          <div>PRO Forest</div>
          <small>Tema hutan dengan aksen hijau</small>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Profile Modal -->
  <div class="modal-overlay" id="profileModal">
    <div class="modal profile-modal">
      <div class="modal-header">
        <h3>Profil Saya PRO</h3>
        <button class="modal-close" id="profileModalClose">&times;</button>
      </div>
      <div class="profile-card">
        <div class="avatar-wrap">
          <img src="" alt="Avatar" class="avatar-img" id="profileAvatarImg">
          <button class="avatar-change-btn" id="changeAvatarBtn"></button>
        </div>
        <div class="profile-display-name" id="profileDisplayName">Nama Pengguna</div>
        <div class="profile-display-bio" id="profileDisplayBio">Bio Pengguna</div>
      </div>
      <div class="field">
        <label>Nama</label>
        <input type="text" id="profileNameInput" placeholder="Nama Anda">
      </div>
      <div class="field">
        <label>Bio</label>
        <textarea id="profileBioInput" rows="3" placeholder="Ceritakan tentang diri Anda"></textarea>
      </div>
      <div class="avatar-options">
        <div class="avatar-option" data-avatar=""></div>
        <div class="avatar-option" data-avatar=""></div>
        <div class="avatar-option" data-avatar=""></div>
        <div class="avatar-option" data-avatar=""></div>
        <div class="avatar-option" data-avatar=""></div>
        <div class="avatar-option" data-avatar=""></div>
      </div>
      <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
      <div class="actions">
        <button class="btn" id="saveProfileBtn">Simpan</button>
      </div>
    </div>
  </div>
  
  <!-- Crop Modal -->
  <div class="modal-overlay" id="cropModal">
    <div class="modal crop-modal">
      <div class="modal-header">
        <h3>Potong Foto</h3>
        <button class="modal-close" id="cropModalClose">&times;</button>
      </div>
      <div class="crop-container">
        <canvas id="cropCanvas"></canvas>
        <div class="crop-area" id="cropArea" style="display: none;">
          <div class="crop-handle nw"></div>
          <div class="crop-handle ne"></div>
          <div class="crop-handle sw"></div>
          <div class="crop-handle se"></div>
        </div>
      </div>
      <div class="crop-preview">
        <img id="cropPreview" src="" alt="Preview">
      </div>
      <div class="crop-size-controls">
        <label>Ukuran:</label>
        <input type="range" id="cropSizeSlider" min="50" max="200" value="100" class="size-slider">
        <span id="cropSizeValue">100%</span>
      </div>
      <div class="crop-controls">
        <button class="btn" id="cancelCropBtn">Batal</button>
        <button class="btn" id="applyCropBtn">Terapkan</button>
      </div>
      <p style="text-align: center; font-size: 12px; color: var(--muted);">Geser area crop dan atur ukuran sesuai keinginan</p>
    </div>
  </div>
  
  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Pengaturan PRO</h3>
        <button class="modal-close" id="settingsModalClose">&times;</button>
      </div>
      <div class="settings-content">
        <div class="setting-group">
          <h4>Notifikasi</h4>
          <div class="field">
            <label>
              <input type="checkbox" id="notificationsEnabled"> Aktifkan Notifikasi
            </label>
          </div>
          <div class="field">
            <label>Peringatkan sebelum (hari):</label>
            <select id="notificationLeadDays">
              <option value="1">1 hari</option>
              <option value="2">2 hari</option>
              <option value="3">3 hari</option>
            </select>
          </div>
          <div class="field">
            <label>
              <input type="checkbox" id="useBrowserNotification"> Gunakan Notifikasi Browser
            </label>
          </div>
        </div>
        
        <div class="setting-group">
          <h4>Fitur Baru PRO</h4>
          <div class="field">
            <label>
              <input type="checkbox" id="autoSaveEnabled"> Simpan Otomatis
            </label>
          </div>
          <div class="field">
            <label>
              <input type="checkbox" id="quickActionsEnabled"> Tampilkan Aksi Cepat
            </label>
          </div>
          <div class="field">
            <label>
              <input type="checkbox" id="darkReaderEnabled"> Mode Baca Gelap
            </label>
          </div>
        </div>
        
        <div class="setting-group">
          <h4>Tampilan</h4>
          <div class="field">
            <label>
              <input type="checkbox" id="liteMode"> Mode Ringan (nonaktifkan animasi)
            </label>
          </div>
        </div>
        
        <div class="actions">
          <button class="btn" id="saveSettingsBtn">Simpan Pengaturan</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Tips Modal -->
  <div class="modal-overlay" id="tipsModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Tips & Panduan PRO</h3>
        <button class="modal-close" id="tipsModalClose">&times;</button>
      </div>
      <div class="tips-content">
        <div class="tip-item">
          <h4> Kelola Tugas dengan Efisien</h4>
          <p>Gunakan fitur prioritas untuk mengurutkan tugas berdasarkan tingkat kepentingan. Tugas dengan prioritas tinggi akan ditandai dengan warna merah.</p>
        </div>
        <div class="tip-item">
          <h4> Manfaatkan Fokus Timer PRO</h4>
          <p>Gunakan timer fokus untuk meningkatkan produktivitas. Atur durasi sesuai kebutuhan dan istirahat sejenak setelah sesi fokus selesai.</p>
        </div>
        <div class="tip-item">
          <h4> Pantau Deadline dengan Kalender</h4>
          <p>Gunakan kalender untuk melihat tugas berdasarkan tanggal. Titik warna pada tanggal menandakan ada tugas yang harus diselesaikan.</p>
        </div>
        <div class="tip-item">
          <h4> Personalisasi Tampilan</h4>
          <p>Ubah tema aplikasi sesuai preferensi Anda. Tersedia tema gelap, terang, dan profesional dengan berbagai aksen warna.</p>
        </div>
        <div class="tip-item">
          <h4> Pantau Statistik Produktivitas</h4>
          <p>Lihat statistik untuk melacak kemajuan Anda. Grafik akan membantu Anda memahami pola produktivitas dari waktu ke waktu.</p>
        </div>
        <div class="tip-item">
          <h4> Aktifkan Notifikasi</h4>
          <p>Nyalakan notifikasi untuk mendapatkan pengingat tentang tugas yang mendekati deadline. Atur berapa hari sebelumnya Anda ingin diingatkan.</p>
        </div>
        <div class="tip-item">
          <h4> Optimalkan untuk Perangkat</h4>
          <p>Aktifkan mode ringan jika menggunakan perangkat dengan spesifikasi rendah. Mode ini akan menonaktifkan animasi untuk performa yang lebih baik.</p>
        </div>
        <div class="tip-item">
          <h4> Manfaatkan Fitur PRO</h4>
          <p>Dengan versi PRO, Anda mendapatkan akses ke dashboard analitik lengkap, tema premium, dan fitur-fitur produktivitas lanjutan.</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- About Modal -->
  <div class="modal-overlay" id="aboutModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Tentang Aplikasi PRO</h3>
        <button class="modal-close" id="aboutModalClose">&times;</button>
      </div>
      <div class="about-section">
        <div class="about-logo">
          <div class="logo">
            <img src="my-icon.png" alt="App Icon" class="app-icon">
          </div>
          <h2>TugasKu3 <span class="pro-badge">PRO</span></h2>
        </div>
        <p>TugasKu3 PRO adalah aplikasi manajemen tugas premium yang dirancang untuk membantu pelajar dan mahasiswa mengatur tugas, jadwal, dan meningkatkan produktivitas dengan fitur-fitur canggih.</p>
        <h4>Fitur Utama PRO:</h4>
        <ul class="feature-list">
          <li>Dashboard analitik lengkap dengan statistik real-time</li>
          <li>Manajemen tugas dengan prioritas dan deadline</li>
          <li>Jadwal mingguan terorganisir</li>
          <li>Catatan pribadi dengan warna dan pin</li>
          <li>Kalender integrasi</li>
          <li>Timer Fokus PRO untuk produktivitas maksimal</li>
          <li>Statistik produktivitas mendalam</li>
          <li>Tema premium eksklusif</li>
          <li>Backup dan restore data</li>
          <li>Notifikasi tugas mendekati deadline</li>
          <li>Profil pengguna dengan foto avatar</li>
          <li>Mode ringan untuk perangkat rendah</li>
        </ul>
        <div class="version-info">
          <p>Versi: 5.0.0 PRO</p>
          <p>Dikembangkan dengan  oleh Tim TugasKu</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Notifications Modal -->
  <div class="modal-overlay" id="notificationsModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Notifikasi</h3>
        <button class="modal-close" id="notificationsModalClose">&times;</button>
      </div>
      <div id="notificationsList">
        <div class="empty-state">
          <h3>Tidak ada notifikasi</h3>
          <p>Notifikasi akan muncul di sini</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Aplikasi TugasKu3 PRO - JavaScript Utama
    document.addEventListener('DOMContentLoaded', function() {
      // Inisialisasi variabel global
      let tasks = [];
      let schedules = [];
      let notes = [];
      let currentFilter = 'all';
      let currentEditTaskId = null;
      let currentEditNoteId = null;
      let currentEditScheduleId = null;
      let timerInterval = null;
      let timerSeconds = 25 * 60; // Default 25 menit
      let timerMode = 'focus'; // focus, short, long
      let isTimerRunning = false;
      let currentMonth = new Date();
      let selectedDate = null;
      let homeTaskChart = null;
      let taskChart = null;
      let priorityChart = null;
      let productivityChart = null;
      let dashboardActivityChart = null;
      
      // Konstanta timer
      let FOCUS_TIME = 25 * 60; // 25 menit
      let SHORT_BREAK_TIME = 5 * 60; // 5 menit
      let LONG_BREAK_TIME = 15 * 60; // 15 menit
      
      // Variabel untuk crop avatar
      let cropImage = null;
      let cropCanvas = null;
      let cropCtx = null;
      let cropArea = null;
      let isDragging = false;
      let isResizing = false;
      let resizeDirection = null;
      let startX, startY;
      let cropSize = 100; // persentase
      
      // Sembunyikan splash screen setelah 1.5 detik
      setTimeout(() => {
        document.getElementById('splash').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
      }, 1500);
      
      // Load data dari localStorage
      loadData();
      
      // Inisialisasi tema
      initTheme();
      
      // Inisialisasi event listeners
      initEventListeners();
      
      // Render data awal
      renderTasks();
      renderSchedules();
      renderNotes();
      renderCalendar();
      updateStats();
      updateNotificationBadge();
      updateDashboard();
      initCharts();
      initSettings();
      
      // Fungsi untuk memuat data dari localStorage
      function loadData() {
        // Load tasks
        const savedTasks = localStorage.getItem('tugasku_tasks');
        if (savedTasks) {
          tasks = JSON.parse(savedTasks);
        }
        
        // Load schedules
        const savedSchedules = localStorage.getItem('tugasku_schedules');
        if (savedSchedules) {
          schedules = JSON.parse(savedSchedules);
        }
        
        // Load notes
        const savedNotes = localStorage.getItem('tugasku_notes');
        if (savedNotes) {
          notes = JSON.parse(savedNotes);
        }
        
        // Load profile
        const savedProfile = localStorage.getItem('tugasku_profile');
        if (savedProfile) {
          const profile = JSON.parse(savedProfile);
          updateProfileUI(profile);
        }
        
        // Load timer stats
        const savedPomodoros = localStorage.getItem('tugasku_pomodoros');
        if (savedPomodoros) {
          const pomodoros = JSON.parse(savedPomodoros);
          updatePomodoroStats(pomodoros);
        }
        
        // Load settings
        const savedSettings = localStorage.getItem('tugasku_settings');
        if (savedSettings) {
          const settings = JSON.parse(savedSettings);
          applySettings(settings);
        }
      }
      
      // Fungsi untuk memperbarui UI profil
      function updateProfileUI(profile) {
        document.getElementById('profileName').textContent = profile.name || 'Pengguna TugasKu';
        document.getElementById('profileDesc').textContent = profile.bio || 'Pelajar Aktif';
        document.getElementById('profileAvatar').innerHTML = profile.avatarImg ? 
          `<img src="${profile.avatarImg}" alt="Avatar">` : profile.avatar || '';
        document.getElementById('profileAvatarImg').src = profile.avatarImg || '';
      }
      
      // Fungsi untuk menyimpan data ke localStorage
      function saveData() {
        localStorage.setItem('tugasku_tasks', JSON.stringify(tasks));
        localStorage.setItem('tugasku_schedules', JSON.stringify(schedules));
        localStorage.setItem('tugasku_notes', JSON.stringify(notes));
      }
      
      // Fungsi untuk inisialisasi tema
      function initTheme() {
        const savedTheme = localStorage.getItem('tugasku_theme') || 'dark';
        setTheme(savedTheme);
      }
      
      // Fungsi untuk mengatur tema
      function setTheme(theme) {
        // Remove all theme classes
        document.body.classList.remove('light-mode', 'dark-pro-mode', 'dark-pro-shift-mode', 
                                      'midnight-tech-mode', 'carbon-blue-mode', 'cyber-gray-mode', 
                                      'blue-mist-mode', 'pink-elegant-mode', 'pro-gold-mode',
                                      'pro-deep-ocean-mode', 'pro-forest-mode');
        
        // Add selected theme class
        if (theme !== 'dark') {
          document.body.classList.add(theme + '-mode');
        }
        
        // Update CSS variables for primary color RGB
        updatePrimaryColorRGB();
        
        // Save theme preference
        localStorage.setItem('tugasku_theme', theme);
      }
      
      // Fungsi untuk mengupdate nilai RGB dari warna primary
      function updatePrimaryColorRGB() {
        const primaryColor = getComputedStyle(document.body).getPropertyValue('--primary').trim();
        let r, g, b;
        
        if (primaryColor.startsWith('#')) {
          // Hex color
          const hex = primaryColor.substring(1);
          r = parseInt(hex.substring(0, 2), 16);
          g = parseInt(hex.substring(2, 4), 16);
          b = parseInt(hex.substring(4, 6), 16);
        } else if (primaryColor.startsWith('rgb')) {
          // RGB color
          const rgb = primaryColor.match(/\d+/g);
          r = parseInt(rgb[0]);
          g = parseInt(rgb[1]);
          b = parseInt(rgb[2]);
        } else {
          // Default fallback
          r = 139; g = 92; b = 246; // Default purple
        }
        
        document.documentElement.style.setProperty('--primary-rgb', `${r}, ${g}, ${b}`);
      }
      
      // Fungsi untuk inisialisasi settings
      function initSettings() {
        const savedSettings = localStorage.getItem('tugasku_settings');
        if (savedSettings) {
          const settings = JSON.parse(savedSettings);
          applySettings(settings);
        }
        
        // Start notification checker
        startNotificationChecker();
      }
      
      // Fungsi untuk menerapkan settings
      function applySettings(settings) {
        // Update timer durations
        if (settings.timer && settings.timer.durations) {
          FOCUS_TIME = (settings.timer.durations.focus || 25) * 60;
          SHORT_BREAK_TIME = (settings.timer.durations.short || 5) * 60;
          LONG_BREAK_TIME = (settings.timer.durations.long || 15) * 60;
          
          // Update timer display
          resetTimer();
        }
        
        // Apply lite mode
        if (settings.liteMode) {
          document.body.classList.add('lite-mode');
        } else {
          document.body.classList.remove('lite-mode');
        }
        
        // Update productivity tab title if timer name is set
        if (settings.timer && settings.timer.name) {
          document.querySelector('#productivityTab .productivity-card h3').textContent = ` ${settings.timer.name}`;
        }
        
        // Update timer settings inputs
        updateTimerSettingsDisplay();
      }
      
      // Fungsi untuk inisialisasi event listeners
      function initEventListeners() {
        // Menu toggle
        document.getElementById('menuBtn').addEventListener('click', openMenu);
        document.getElementById('menuClose').addEventListener('click', closeMenu);
        
        // Menu items
        document.querySelectorAll('.menu-item').forEach(item => {
          item.addEventListener('click', handleMenuAction);
        });
        
        // Tab navigation
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', switchTab);
        });
        
        // FAB
        document.getElementById('addTaskBtn').addEventListener('click', openAddTaskModal);
        
        // Task modal
        document.getElementById('taskModalClose').addEventListener('click', closeTaskModal);
        document.getElementById('cancelTaskBtn').addEventListener('click', closeTaskModal);
        document.getElementById('taskForm').addEventListener('submit', saveTask);
        
        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.addEventListener('click', setFilter);
        });
        
        // Search
        document.getElementById('taskSearch').addEventListener('input', searchTasks);
        
        // Stats modal
        document.getElementById('statsBtn').addEventListener('click', openStatsModal);
        document.getElementById('statsModalClose').addEventListener('click', closeStatsModal);
        
        // Theme modal
        document.getElementById('themeModalClose').addEventListener('click', closeThemeModal);
        document.querySelectorAll('.theme-option').forEach(option => {
          option.addEventListener('click', changeTheme);
        });
        
        // Profile modal
        document.getElementById('profileModalClose').addEventListener('click', closeProfileModal);
        document.getElementById('saveProfileBtn').addEventListener('click', saveProfile);
        document.querySelectorAll('.avatar-option').forEach(option => {
          option.addEventListener('click', selectAvatar);
        });
        document.getElementById('changeAvatarBtn').addEventListener('click', () => {
          document.getElementById('avatarUpload').click();
        });
        document.getElementById('avatarUpload').addEventListener('change', handleAvatarUpload);
        
        // Crop modal
        document.getElementById('cropModalClose').addEventListener('click', closeCropModal);
        document.getElementById('cancelCropBtn').addEventListener('click', closeCropModal);
        document.getElementById('applyCropBtn').addEventListener('click', applyCrop);
        document.getElementById('cropSizeSlider').addEventListener('input', updateCropSize);
        
        // Settings modal
        document.getElementById('settingsModalClose').addEventListener('click', closeSettingsModal);
        document.getElementById('saveSettingsBtn').addEventListener('click', saveSettingsFunc);
        
        // Timer settings
        document.getElementById('saveTimerSettings').addEventListener('click', saveTimerSettings);
        
        // Tips modal
        document.getElementById('tipsModalClose').addEventListener('click', closeTipsModal);
        
        // About modal
        document.getElementById('aboutModalClose').addEventListener('click', closeAboutModal);
        
        // Schedule form
        document.getElementById('addScheduleBtn').addEventListener('click', addSchedule);
        
        // Note form
        document.getElementById('addNoteBtn').addEventListener('click', addNote);
        
        // Calendar navigation
        document.getElementById('prevMonth').addEventListener('click', previousMonth);
        document.getElementById('nextMonth').addEventListener('click', nextMonth);
        
        // Timer
        document.getElementById('startTimer').addEventListener('click', startTimer);
        document.getElementById('pauseTimer').addEventListener('click', pauseTimer);
        document.getElementById('resetTimer').addEventListener('click', resetTimer);
        document.querySelectorAll('.timer-mode-btn').forEach(btn => {
          btn.addEventListener('click', changeTimerMode);
        });
        
        // Notifications modal
        document.getElementById('notifBtn').addEventListener('click', openNotificationsModal);
        document.getElementById('notificationsModalClose').addEventListener('click', closeNotificationsModal);
        
        // Close modals when clicking outside
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
          overlay.addEventListener('click', function(e) {
            if (e.target === overlay) {
              overlay.classList.remove('show');
            }
          });
        });
        
        // Touch events for swipe on mobile
        initTouchEvents();
      }
      
      // Fungsi untuk inisialisasi event touch untuk swipe
      function initTouchEvents() {
        let startX = 0;
        let startY = 0;
        
        document.addEventListener('touchstart', (e) => {
          startX = e.touches[0].clientX;
          startY = e.touches[0].clientY;
        });
        
        document.addEventListener('touchend', (e) => {
          if (!startX || !startY) return;
          
          const endX = e.changedTouches[0].clientX;
          const endY = e.changedTouches[0].clientY;
          
          const diffX = startX - endX;
          const diffY = startY - endY;
          
          // Horizontal swipe (minimal movement in X and not too much in Y)
          if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50 && Math.abs(diffY) < 100) {
            // Swipe left
            if (diffX > 0) {
              nextTab();
            } 
            // Swipe right
            else {
              previousTab();
            }
          }
          
          startX = 0;
          startY = 0;
        });
      }
      
      // Fungsi untuk beralih ke tab berikutnya
      function nextTab() {
        const tabs = Array.from(document.querySelectorAll('.tab-btn'));
        const activeIndex = tabs.findIndex(tab => tab.classList.contains('active'));
        const nextIndex = (activeIndex + 1) % tabs.length;
        tabs[nextIndex].click();
      }
      
      // Fungsi untuk beralih ke tab sebelumnya
      function previousTab() {
        const tabs = Array.from(document.querySelectorAll('.tab-btn'));
        const activeIndex = tabs.findIndex(tab => tab.classList.contains('active'));
        const prevIndex = (activeIndex - 1 + tabs.length) % tabs.length;
        tabs[prevIndex].click();
      }
      
      // Fungsi untuk membuka menu
      function openMenu() {
        document.getElementById('menuDrawer').classList.add('open');
      }
      
      // Fungsi untuk menutup menu
      function closeMenu() {
        document.getElementById('menuDrawer').classList.remove('open');
      }
      
      // Fungsi untuk menangani aksi menu
      function handleMenuAction(e) {
        const action = e.currentTarget.getAttribute('data-action');
        
        switch(action) {
          case 'portfolio':
            window.open('https://portofolio-rahmatt.netlify.app', '_blank');
            break;
          case 'profile':
            openProfileModal();
            break;
          case 'settings':
            openSettingsModal();
            break;
          case 'tips':
            openTipsModal();
            break;
          case 'focus':
            switchTab('productivity');
            break;
          case 'backup':
            backupData();
            break;
          case 'export':
            exportData();
            break;
          case 'import':
            importData();
            break;
          case 'theme':
            openThemeModal();
            break;
          case 'about':
            openAboutModal();
            break;
          case 'reset':
            resetData();
            break;
        }
        
        closeMenu();
      }
      
      // Fungsi untuk beralih tab
      function switchTab(e) {
        const tabId = typeof e === 'string' ? e : e.currentTarget.getAttribute('data-tab');
        
        // Update active tab button
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        document.querySelector(`.tab-btn[data-tab="${tabId}"]`).classList.add('active');
        
        // Update active tab content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(`${tabId}Tab`).classList.add('active');
        
        // Special handling for certain tabs
        if (tabId === 'calendar') {
          renderCalendar();
        } else if (tabId === 'productivity') {
          resetTimer();
        }
      }
      
      // Fungsi untuk membuka modal tambah tugas
      function openAddTaskModal() {
        document.getElementById('taskModalTitle').textContent = 'Tambah Tugas Baru';
        document.getElementById('taskForm').reset();
        currentEditTaskId = null;
        document.getElementById('taskModal').classList.add('show');
      }
      
      // Fungsi untuk membuka modal edit tugas
      function openEditTaskModal(id) {
        const task = tasks.find(t => t.id === id);
        if (!task) return;
        
        document.getElementById('taskModalTitle').textContent = 'Edit Tugas';
        document.getElementById('taskTitle').value = task.title;
        document.getElementById('taskDesc').value = task.description || '';
        document.getElementById('taskDeadline').value = task.deadline || '';
        document.getElementById('taskPriority').value = task.priority || 'medium';
        document.getElementById('taskCategory').value = task.category || '';
        currentEditTaskId = id;
        document.getElementById('taskModal').classList.add('show');
      }
      
      // Fungsi untuk menutup modal tugas
      function closeTaskModal() {
        document.getElementById('taskModal').classList.remove('show');
      }
      
      // Fungsi untuk menyimpan tugas
      function saveTask(e) {
        e.preventDefault();
        
        const title = document.getElementById('taskTitle').value.trim();
        const description = document.getElementById('taskDesc').value.trim();
        const deadline = document.getElementById('taskDeadline').value;
        const priority = document.getElementById('taskPriority').value;
        const category = document.getElementById('taskCategory').value.trim();
        
        if (!title) {
          showToast('Judul tugas tidak boleh kosong', 'error');
          return;
        }
        
        if (currentEditTaskId) {
          // Edit existing task
          const taskIndex = tasks.findIndex(t => t.id === currentEditTaskId);
          if (taskIndex !== -1) {
            tasks[taskIndex].title = title;
            tasks[taskIndex].description = description;
            tasks[taskIndex].deadline = deadline;
            tasks[taskIndex].priority = priority;
            tasks[taskIndex].category = category;
            tasks[taskIndex].updatedAt = new Date().toISOString();
          }
        } else {
          // Add new task
          const newTask = {
            id: Date.now().toString(),
            title,
            description,
            deadline,
            priority,
            category,
            completed: false,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
          };
          
          tasks.push(newTask);
        }
        
        saveData();
        renderTasks();
        updateStats();
        updateNotificationBadge();
        updateDashboard();
        closeTaskModal();
        showToast(currentEditTaskId ? 'Tugas berhasil diperbarui' : 'Tugas berhasil ditambahkan');
      }
      
      // Fungsi untuk toggle status tugas (selesai/belum)
      function toggleTaskStatus(id) {
        const taskIndex = tasks.findIndex(t => t.id === id);
        if (taskIndex !== -1) {
          tasks[taskIndex].completed = !tasks[taskIndex].completed;
          tasks[taskIndex].updatedAt = new Date().toISOString();
          
          // Update pomodoro stats if task was completed
          if (tasks[taskIndex].completed) {
            updatePomodoroStats({ tasksCompleted: 1 });
          }
          
          saveData();
          renderTasks();
          updateStats();
          updateDashboard();
          showToast(tasks[taskIndex].completed ? 'Tugas ditandai selesai' : 'Tugas dibuka kembali');
        }
      }
      
      // Fungsi untuk menghapus tugas
      function deleteTask(id) {
        if (confirm('Apakah Anda yakin ingin menghapus tugas ini?')) {
          tasks = tasks.filter(t => t.id !== id);
          saveData();
          renderTasks();
          updateStats();
          updateDashboard();
          showToast('Tugas berhasil dihapus');
        }
      }
      
      // Fungsi untuk mengatur filter
      function setFilter(e) {
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        e.currentTarget.classList.add('active');
        
        currentFilter = e.currentTarget.getAttribute('data-filter');
        renderTasks();
      }
      
      // Fungsi untuk mencari tugas
      function searchTasks() {
        renderTasks();
      }
      
      // Fungsi untuk merender daftar tugas
      function renderTasks() {
        const tasksList = document.getElementById('tasksList');
        const searchTerm = document.getElementById('taskSearch').value.toLowerCase();
        
        // Filter tasks based on current filter and search
        let filteredTasks = tasks.filter(task => {
          const matchesSearch = task.title.toLowerCase().includes(searchTerm) || 
                               (task.description && task.description.toLowerCase().includes(searchTerm)) ||
                               (task.category && task.category.toLowerCase().includes(searchTerm));
          
          if (!matchesSearch) return false;
          
          switch(currentFilter) {
            case 'pending':
              return !task.completed;
            case 'completed':
              return task.completed;
            case 'overdue':
              return !task.completed && task.deadline && new Date(task.deadline) < new Date();
            case 'high':
              return task.priority === 'high';
            case 'today':
              if (!task.deadline) return false;
              const today = new Date().toISOString().split('T')[0];
              return task.deadline === today;
            default:
              return true;
          }
        });
        
        // Sort tasks by priority and deadline
        filteredTasks.sort((a, b) => {
          // First by completion status
          if (a.completed !== b.completed) {
            return a.completed ? 1 : -1;
          }
          
          // Then by priority (high > medium > low)
          const priorityOrder = { high: 3, medium: 2, low: 1 };
          if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
            return priorityOrder[b.priority] - priorityOrder[a.priority];
          }
          
          // Then by deadline (closest first)
          if (a.deadline && b.deadline) {
            return new Date(a.deadline) - new Date(b.deadline);
          } else if (a.deadline) {
            return -1;
          } else if (b.deadline) {
            return 1;
          }
          
          // Finally by creation date (newest first)
          return new Date(b.createdAt) - new Date(a.createdAt);
        });
        
        if (filteredTasks.length === 0) {
          tasksList.innerHTML = `
            <div class="empty-state">
              <h3>Tidak ada tugas</h3>
              <p>${searchTerm ? 'Tidak ada tugas yang sesuai dengan pencarian' : 'Tambahkan tugas baru dengan tombol + di bawah'}</p>
            </div>
          `;
          return;
        }
        
        tasksList.innerHTML = filteredTasks.map(task => {
          const deadlineClass = getDeadlineClass(task.deadline, task.completed);
          const priorityClass = `priority-${task.priority}`;
          const priorityIndicator = `<span class="priority-indicator priority-${task.priority}-indicator"></span>`;
          const statusText = task.completed ? 'Selesai' : getDeadlineText(task.deadline);
          
          return `
            <div class="task-card ${priorityClass} ${deadlineClass}" draggable="true" data-id="${task.id}">
              <div class="task-title">
                ${priorityIndicator}
                <span class="title-text">${task.title}</span>
                <span class="status-pill ${task.completed ? 'dl-ok' : deadlineClass}">${statusText}</span>
              </div>
              ${task.description ? `<div class="task-detail"><span class="long-text">${task.description}</span></div>` : ''}
              <div class="task-detail">
                ${task.category ? `<span> ${task.category}</span>` : ''}
                ${task.deadline ? `<span> ${formatDate(task.deadline)}</span>` : ''}
                <span>${getPriorityText(task.priority)}</span>
              </div>
              <div class="task-actions">
                <button class="btn" onclick="toggleTaskStatus('${task.id}')">${task.completed ? ' Buka' : ' Selesai'}</button>
                <button class="btn" onclick="openEditTaskModal('${task.id}')"> Edit</button>
                <button class="btn" onclick="deleteTask('${task.id}')"> Hapus</button>
              </div>
            </div>
          `;
        }).join('');
        
        // Add drag and drop functionality
        initDragAndDrop();
      }
      
      // Fungsi untuk mendapatkan kelas deadline
      function getDeadlineClass(deadline, completed) {
        if (completed) return 'dl-ok';
        if (!deadline) return '';
        
        const today = new Date();
        const deadlineDate = new Date(deadline);
        const diffTime = deadlineDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays < 0) return 'dl-overdue';
        if (diffDays === 0) return 'dl-urgent';
        if (diffDays <= 2) return 'dl-soon';
        return 'dl-ok';
      }
      
      // Fungsi untuk mendapatkan teks deadline
      function getDeadlineText(deadline) {
        if (!deadline) return 'Tidak ada deadline';
        
        const today = new Date();
        const deadlineDate = new Date(deadline);
        const diffTime = deadlineDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays < 0) return `Terlambat ${Math.abs(diffDays)} hari`;
        if (diffDays === 0) return 'Deadline hari ini';
        if (diffDays === 1) return 'Besok deadline';
        if (diffDays <= 7) return `${diffDays} hari lagi`;
        return `${Math.ceil(diffDays / 7)} minggu lagi`;
      }
      
      // Fungsi untuk mendapatkan teks prioritas
      function getPriorityText(priority) {
        const priorityTexts = {
          high: ' Tinggi',
          medium: ' Sedang',
          low: ' Rendah'
        };
        return priorityTexts[priority] || 'Tidak ada';
      }
      
      // Fungsi untuk memformat tanggal
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('id-ID', {
          day: 'numeric',
          month: 'short',
          year: 'numeric'
        });
      }
      
      // Fungsi untuk inisialisasi drag and drop
      function initDragAndDrop() {
        const taskCards = document.querySelectorAll('.task-card');
        
        taskCards.forEach(card => {
          card.addEventListener('dragstart', handleDragStart);
          card.addEventListener('dragend', handleDragEnd);
        });
        
        const tasksList = document.getElementById('tasksList');
        tasksList.addEventListener('dragover', handleDragOver);
        tasksList.addEventListener('drop', handleDrop);
      }
      
      // Fungsi untuk menangani drag start
      function handleDragStart(e) {
        e.currentTarget.classList.add('dragging');
        e.dataTransfer.setData('text/plain', e.currentTarget.getAttribute('data-id'));
      }
      
      // Fungsi untuk menangani drag end
      function handleDragEnd(e) {
        e.currentTarget.classList.remove('dragging');
      }
      
      // Fungsi untuk menangani drag over
      function handleDragOver(e) {
        e.preventDefault();
      }
      
      // Fungsi untuk menangani drop
      function handleDrop(e) {
        e.preventDefault();
        const taskId = e.dataTransfer.getData('text/plain');
        const taskCard = document.querySelector(`.task-card[data-id="${taskId}"]`);
        const tasksList = document.getElementById('tasksList');
        
        // Get the drop target
        const afterElement = getDragAfterElement(tasksList, e.clientY);
        
        if (afterElement) {
          tasksList.insertBefore(taskCard, afterElement);
        } else {
          tasksList.appendChild(taskCard);
        }
        
        // Update task order in the array
        const taskIndex = tasks.findIndex(t => t.id === taskId);
        if (taskIndex !== -1) {
          const [task] = tasks.splice(taskIndex, 1);
          const newIndex = Array.from(tasksList.children).indexOf(taskCard);
          tasks.splice(newIndex, 0, task);
          saveData();
        }
      }
      
      // Fungsi untuk mendapatkan elemen setelah drag
      function getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.task-card:not(.dragging)')];
        
        return draggableElements.reduce((closest, child) => {
          const box = child.getBoundingClientRect();
          const offset = y - box.top - box.height / 2;
          
          if (offset < 0 && offset > closest.offset) {
            return { offset: offset, element: child };
          } else {
            return closest;
          }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
      }
      
      // Fungsi untuk menambahkan jadwal
      function addSchedule() {
        const day = document.getElementById('scheduleDay').value;
        const time = document.getElementById('scheduleTime').value;
        const subject = document.getElementById('scheduleSubject').value.trim();
        const description = document.getElementById('scheduleDesc').value.trim();
        
        if (!time || !subject) {
          showToast('Waktu dan mata pelajaran harus diisi', 'error');
          return;
        }
        
        if (currentEditScheduleId) {
          // Edit existing schedule
          const scheduleIndex = schedules.findIndex(s => s.id === currentEditScheduleId);
          if (scheduleIndex !== -1) {
            schedules[scheduleIndex].day = day;
            schedules[scheduleIndex].time = time;
            schedules[scheduleIndex].subject = subject;
            schedules[scheduleIndex].description = description;
          }
        } else {
          // Add new schedule
          const newSchedule = {
            id: Date.now().toString(),
            day,
            time,
            subject,
            description
          };
          
          schedules.push(newSchedule);
        }
        
        saveData();
        renderSchedules();
        showToast(currentEditScheduleId ? 'Jadwal berhasil diperbarui' : 'Jadwal berhasil ditambahkan');
        
        // Reset form
        document.getElementById('scheduleTime').value = '';
        document.getElementById('scheduleSubject').value = '';
        document.getElementById('scheduleDesc').value = '';
        currentEditScheduleId = null;
      }
      
      // Fungsi untuk merender jadwal
      function renderSchedules() {
        const scheduleList = document.getElementById('scheduleList');
        const days = ['senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu', 'minggu'];
        
        if (schedules.length === 0) {
          scheduleList.innerHTML = `
            <div class="empty-state">
              <h3>Belum ada jadwal</h3>
              <p>Tambahkan jadwal mingguan Anda</p>
            </div>
          `;
          return;
        }
        
        scheduleList.innerHTML = '';
        
        days.forEach(day => {
          const daySchedules = schedules
            .filter(s => s.day === day)
            .sort((a, b) => a.time.localeCompare(b.time));
          
          if (daySchedules.length === 0) return;
          
          const dayElement = document.createElement('div');
          dayElement.className = 'schedule-day';
          
          const dayName = day.charAt(0).toUpperCase() + day.slice(1);
          dayElement.innerHTML = `
            <div class="schedule-header">${dayName}</div>
            ${daySchedules.map(schedule => `
              <div class="schedule-item" data-id="${schedule.id}">
                <div class="schedule-time">${schedule.time}</div>
                <div class="schedule-subject">${schedule.subject}</div>
                <div class="schedule-actions">
                  <button class="icon-btn" onclick="editSchedule('${schedule.id}')"></button>
                  <button class="icon-btn" onclick="deleteSchedule('${schedule.id}')"></button>
                </div>
              </div>
            `).join('')}
          `;
          
          scheduleList.appendChild(dayElement);
        });
      }
      
      // Fungsi untuk mengedit jadwal
      function editSchedule(id) {
        const schedule = schedules.find(s => s.id === id);
        if (!schedule) return;
        
        document.getElementById('scheduleDay').value = schedule.day;
        document.getElementById('scheduleTime').value = schedule.time;
        document.getElementById('scheduleSubject').value = schedule.subject;
        document.getElementById('scheduleDesc').value = schedule.description || '';
        currentEditScheduleId = id;
        
        // Scroll to form
        document.getElementById('scheduleTab').scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      }
      
      // Fungsi untuk menghapus jadwal
      function deleteSchedule(id) {
        if (confirm('Apakah Anda yakin ingin menghapus jadwal ini?')) {
          schedules = schedules.filter(s => s.id !== id);
          saveData();
          renderSchedules();
          showToast('Jadwal berhasil dihapus');
        }
      }
      
      // Fungsi untuk menambahkan catatan
      function addNote() {
        const title = document.getElementById('noteTitle').value.trim();
        const content = document.getElementById('noteContent').value.trim();
        const color = document.getElementById('noteColor').value;
        const pinned = document.getElementById('notePinned').checked;
        
        if (!title || !content) {
          showToast('Judul dan isi catatan harus diisi', 'error');
          return;
        }
        
        if (currentEditNoteId) {
          // Edit existing note
          const noteIndex = notes.findIndex(n => n.id === currentEditNoteId);
          if (noteIndex !== -1) {
            notes[noteIndex].title = title;
            notes[noteIndex].content = content;
            notes[noteIndex].color = color;
            notes[noteIndex].pinned = pinned;
            notes[noteIndex].updatedAt = new Date().toISOString();
          }
        } else {
          // Add new note
          const newNote = {
            id: Date.now().toString(),
            title,
            content,
            color,
            pinned,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
          };
          
          notes.push(newNote);
        }
        
        saveData();
        renderNotes();
        showToast(currentEditNoteId ? 'Catatan berhasil diperbarui' : 'Catatan berhasil ditambahkan');
        
        // Reset form
        document.getElementById('noteTitle').value = '';
        document.getElementById('noteContent').value = '';
        document.getElementById('noteColor').value = '';
        document.getElementById('notePinned').checked = false;
        currentEditNoteId = null;
      }
      
      // Fungsi untuk merender catatan
      function renderNotes() {
        const notesList = document.getElementById('notesList');
        
        if (notes.length === 0) {
          notesList.innerHTML = `
            <div class="empty-state">
              <h3>Belum ada catatan</h3>
              <p>Tambahkan catatan pertama Anda</p>
            </div>
          `;
          return;
        }
        
        // Sort notes: pinned first, then by update date
        const sortedNotes = [...notes].sort((a, b) => {
          if (a.pinned !== b.pinned) {
            return a.pinned ? -1 : 1;
          }
          return new Date(b.updatedAt) - new Date(a.updatedAt);
        });
        
        notesList.innerHTML = sortedNotes.map(note => {
          const colorClass = note.color ? `note-${note.color}` : '';
          const pinnedIcon = note.pinned ? ' ' : '';
          
          return `
            <div class="note-card ${colorClass}" data-id="${note.id}">
              <div class="note-title">${pinnedIcon}${note.title}</div>
              <div class="note-content">${note.content}</div>
              <div class="note-meta">Diperbarui: ${formatDateTime(note.updatedAt)}</div>
              <div class="note-actions">
                <button class="btn" onclick="toggleNotePin('${note.id}')">${note.pinned ? ' Lepas' : ' Pin'}</button>
                <button class="btn" onclick="editNote('${note.id}')"> Edit</button>
                <button class="btn" onclick="deleteNote('${note.id}')"> Hapus</button>
              </div>
            </div>
          `;
        }).join('');
      }
      
      // Fungsi untuk memformat tanggal dan waktu
      function formatDateTime(dateString) {
        const date = new Date(dateString);
        return date.toLocaleString('id-ID', {
          day: 'numeric',
          month: 'short',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      }
      
      // Fungsi untuk toggle pin catatan
      function toggleNotePin(id) {
        const noteIndex = notes.findIndex(n => n.id === id);
        if (noteIndex !== -1) {
          notes[noteIndex].pinned = !notes[noteIndex].pinned;
          notes[noteIndex].updatedAt = new Date().toISOString();
          saveData();
          renderNotes();
          showToast(notes[noteIndex].pinned ? 'Catatan dipin' : 'Catatan dilepas');
        }
      }
      
      // Fungsi untuk mengedit catatan
      function editNote(id) {
        const note = notes.find(n => n.id === id);
        if (!note) return;
        
        document.getElementById('noteTitle').value = note.title;
        document.getElementById('noteContent').value = note.content;
        document.getElementById('noteColor').value = note.color || '';
        document.getElementById('notePinned').checked = note.pinned;
        currentEditNoteId = id;
        
        // Scroll to form
        document.getElementById('notesTab').scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      }
      
      // Fungsi untuk menghapus catatan
      function deleteNote(id) {
        if (confirm('Apakah Anda yakin ingin menghapus catatan ini?')) {
          notes = notes.filter(n => n.id !== id);
          saveData();
          renderNotes();
          showToast('Catatan berhasil dihapus');
        }
      }
      
      // Fungsi untuk merender kalender
      function renderCalendar() {
        const calendarGrid = document.getElementById('calendarGrid');
        const currentMonthElement = document.getElementById('currentMonth');
        
        // Set current month text
        const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                           'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
        currentMonthElement.textContent = `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;
        
        // Clear calendar
        calendarGrid.innerHTML = '';
        
        // Add day headers
        const dayNames = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
        dayNames.forEach(day => {
          const dayElement = document.createElement('div');
          dayElement.className = 'calendar-day-header';
          dayElement.textContent = day;
          calendarGrid.appendChild(dayElement);
        });
        
        // Get first day of month and number of days
        const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
        const lastDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
        const daysInMonth = lastDay.getDate();
        
        // Add empty cells for days before the first day of the month
        for (let i = 0; i < firstDay.getDay(); i++) {
          const emptyCell = document.createElement('div');
          emptyCell.className = 'calendar-day';
          calendarGrid.appendChild(emptyCell);
        }
        
        // Add cells for each day of the month
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        for (let day = 1; day <= daysInMonth; day++) {
          const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day);
          const dateString = date.toISOString().split('T')[0];
          
          const dayElement = document.createElement('div');
          dayElement.className = 'calendar-day';
          dayElement.textContent = day;
          dayElement.setAttribute('data-date', dateString);
          
          // Check if today
          if (date.getTime() === today.getTime()) {
            dayElement.classList.add('today');
          }
          
          // Check if has tasks
          const hasTasks = tasks.some(task => {
            if (!task.deadline) return false;
            const taskDate = new Date(task.deadline);
            return taskDate.getDate() === day && 
                   taskDate.getMonth() === currentMonth.getMonth() && 
                   taskDate.getFullYear() === currentMonth.getFullYear();
          });
          
          // Check if has overdue tasks
          const hasOverdue = tasks.some(task => {
            if (!task.deadline || task.completed) return false;
            const taskDate = new Date(task.deadline);
            return taskDate < today && 
                   taskDate.getDate() === day && 
                   taskDate.getMonth() === currentMonth.getMonth() && 
                   taskDate.getFullYear() === currentMonth.getFullYear();
          });
          
          if (hasTasks) {
            dayElement.classList.add('has-task');
            if (hasOverdue) {
              dayElement.classList.add('has-overdue');
            }
          }
          
          // Add click event
          dayElement.addEventListener('click', () => selectDate(dateString));
          
          calendarGrid.appendChild(dayElement);
        }
        
        // Update selected date tasks
        if (selectedDate) {
          updateSelectedDateTasks();
        }
      }
      
      // Fungsi untuk memilih tanggal
      function selectDate(dateString) {
        selectedDate = dateString;
        
        // Update UI
        document.querySelectorAll('.calendar-day').forEach(day => {
          day.classList.remove('selected');
        });
        
        const selectedDay = document.querySelector(`.calendar-day[data-date="${dateString}"]`);
        if (selectedDay) {
          selectedDay.classList.add('selected');
        }
        
        updateSelectedDateTasks();
      }
      
      // Fungsi untuk memperbarui tugas tanggal terpilih
      function updateSelectedDateTasks() {
        const selectedDateElement = document.getElementById('selectedDate');
        const selectedDateTasks = document.getElementById('selectedDateTasks');
        
        if (!selectedDate) {
          selectedDateElement.textContent = '-';
          selectedDateTasks.innerHTML = '<p>Pilih tanggal untuk melihat tugas</p>';
          return;
        }
        
        const date = new Date(selectedDate);
        const dateFormatted = formatDate(selectedDate);
        selectedDateElement.textContent = dateFormatted;
        
        const dateTasks = tasks.filter(task => {
          if (!task.deadline) return false;
          const taskDate = new Date(task.deadline);
          return taskDate.toISOString().split('T')[0] === selectedDate;
        });
        
        if (dateTasks.length === 0) {
          selectedDateTasks.innerHTML = '<p>Tidak ada tugas untuk tanggal ini</p>';
          return;
        }
        
        selectedDateTasks.innerHTML = dateTasks.map(task => {
          const statusClass = task.completed ? 'dl-ok' : getDeadlineClass(task.deadline, task.completed);
          const statusText = task.completed ? 'Selesai' : getDeadlineText(task.deadline);
          
          return `
            <div class="task-card ${statusClass}" style="margin-bottom: 10px;">
              <div class="task-title">
                <span class="title-text">${task.title}</span>
                <span class="status-pill ${statusClass}">${statusText}</span>
              </div>
              ${task.description ? `<div class="task-detail">${task.description}</div>` : ''}
              <div class="task-actions">
                <button class="btn" onclick="toggleTaskStatus('${task.id}')">${task.completed ? ' Buka' : ' Selesai'}</button>
              </div>
            </div>
          `;
        }).join('');
      }
      
      // Fungsi untuk bulan sebelumnya
      function previousMonth() {
        currentMonth.setMonth(currentMonth.getMonth() - 1);
        renderCalendar();
      }
      
      // Fungsi untuk bulan berikutnya
      function nextMonth() {
        currentMonth.setMonth(currentMonth.getMonth() + 1);
        renderCalendar();
      }
      
      // Fungsi untuk mengubah mode timer
      function changeTimerMode(e) {
        document.querySelectorAll('.timer-mode-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        e.currentTarget.classList.add('active');
        
        timerMode = e.currentTarget.getAttribute('data-mode');
        resetTimer();
      }
      
      // Fungsi untuk memulai timer
      function startTimer() {
        if (isTimerRunning) return;
        
        isTimerRunning = true;
        document.getElementById('startTimer').textContent = 'Lanjut';
        document.getElementById('pauseTimer').style.display = 'inline-block';
        
        timerInterval = setInterval(() => {
          timerSeconds--;
          
          updateTimerDisplay();
          
          if (timerSeconds <= 0) {
            clearInterval(timerInterval);
            isTimerRunning = false;
            
            // Play sound
            playTimerSound();
            
            // Show notification
            showToast(`Timer ${timerMode === 'focus' ? 'fokus' : 'istirahat'} selesai!`);
            
            // Update pomodoro stats
            if (timerMode === 'focus') {
              updatePomodoroStats({ pomodoros: 1 });
            }
            
            // Auto-start next timer
            if (timerMode === 'focus') {
              // After focus, start short break
              timerMode = 'short';
              document.querySelectorAll('.timer-mode-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-mode') === 'short') {
                  btn.classList.add('active');
                }
              });
            } else if (timerMode === 'short') {
              // After short break, start focus again
              timerMode = 'focus';
              document.querySelectorAll('.timer-mode-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-mode') === 'focus') {
                  btn.classList.add('active');
                }
              });
            }
            
            resetTimer();
            startTimer();
          }
        }, 1000);
      }
      
      // Fungsi untuk menjeda timer
      function pauseTimer() {
        if (!isTimerRunning) return;
        
        clearInterval(timerInterval);
        isTimerRunning = false;
        document.getElementById('startTimer').textContent = 'Lanjut';
      }
      
      // Fungsi untuk mereset timer
      function resetTimer() {
        clearInterval(timerInterval);
        isTimerRunning = false;
        
        switch(timerMode) {
          case 'focus':
            timerSeconds = FOCUS_TIME;
            break;
          case 'short':
            timerSeconds = SHORT_BREAK_TIME;
            break;
          case 'long':
            timerSeconds = LONG_BREAK_TIME;
            break;
        }
        
        updateTimerDisplay();
        document.getElementById('startTimer').textContent = 'Mulai';
        document.getElementById('pauseTimer').style.display = 'inline-block';
      }
      
      // Fungsi untuk memperbarui tampilan timer
      function updateTimerDisplay() {
        const minutes = Math.floor(timerSeconds / 60);
        const seconds = timerSeconds % 60;
        document.getElementById('timerDisplay').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        // Update progress bar
        let totalSeconds;
        switch(timerMode) {
          case 'focus':
            totalSeconds = FOCUS_TIME;
            break;
          case 'short':
            totalSeconds = SHORT_BREAK_TIME;
            break;
          case 'long':
            totalSeconds = LONG_BREAK_TIME;
            break;
        }
        
        const progress = ((totalSeconds - timerSeconds) / totalSeconds) * 100;
        document.getElementById('timerProgress').style.width = `${progress}%`;
      }
      
      // Fungsi untuk memutar suara timer
      function playTimerSound() {
        // Create audio context for simple beep
        try {
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          oscillator.frequency.value = 800;
          oscillator.type = 'sine';
          
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
          
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 1);
        } catch (e) {
          console.log('Audio not supported');
        }
      }
      
      // Fungsi untuk memperbarui statistik pomodoro
      function updatePomodoroStats(newStats = {}) {
        let pomodoros = JSON.parse(localStorage.getItem('tugasku_pomodoros') || '{}');
        
        // Initialize if empty
        if (!pomodoros.today) {
          const today = new Date().toISOString().split('T')[0];
          pomodoros = {
            today: { date: today, count: 0, tasksCompleted: 0 },
            week: { count: 0, tasksCompleted: 0 },
            total: { count: 0, tasksCompleted: 0, focusTime: 0 }
          };
        }
        
        // Check if today is still the same day
        const today = new Date().toISOString().split('T')[0];
        if (pomodoros.today.date !== today) {
          // Reset today's count
          pomodoros.today = { date: today, count: 0, tasksCompleted: 0 };
        }
        
        // Update stats
        if (newStats.pomodoros) {
          pomodoros.today.count += newStats.pomodoros;
          pomodoros.week.count += newStats.pomodoros;
          pomodoros.total.count += newStats.pomodoros;
          pomodoros.total.focusTime += newStats.pomodoros * (FOCUS_TIME / 60 / 60); // in hours
        }
        
        if (newStats.tasksCompleted) {
          pomodoros.today.tasksCompleted += newStats.tasksCompleted;
          pomodoros.week.tasksCompleted += newStats.tasksCompleted;
          pomodoros.total.tasksCompleted += newStats.tasksCompleted;
        }
        
        // Save updated stats
        localStorage.setItem('tugasku_pomodoros', JSON.stringify(pomodoros));
        
        // Update UI
        updatePomodoroUI(pomodoros);
      }
      
      // Fungsi untuk memperbarui UI pomodoro
      function updatePomodoroUI(pomodoros) {
        document.getElementById('todayPomodoros').textContent = pomodoros.today.count;
        document.getElementById('weekPomodoros').textContent = pomodoros.week.count;
        document.getElementById('totalPomodoros').textContent = pomodoros.total.count;
        document.getElementById('focusTime').textContent = pomodoros.total.focusTime.toFixed(1);
      }
      
      // Fungsi untuk memperbarui statistik
      function updateStats() {
        const totalTasks = tasks.length;
        const completedTasks = tasks.filter(t => t.completed).length;
        const pendingTasks = totalTasks - completedTasks;
        const overdueTasks = tasks.filter(t => 
          !t.completed && t.deadline && new Date(t.deadline) < new Date()
        ).length;
        
        const today = new Date().toISOString().split('T')[0];
        const todayTasks = tasks.filter(t => t.deadline === today).length;
        
        const weekStart = new Date();
        weekStart.setDate(weekStart.getDate() - weekStart.getDay());
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekEnd.getDate() + 6);
        
        const weekTasks = tasks.filter(t => {
          if (!t.deadline) return false;
          const taskDate = new Date(t.deadline);
          return taskDate >= weekStart && taskDate <= weekEnd;
        }).length;
        
        // Update home stats
        document.getElementById('totalTasksHome').textContent = totalTasks;
        document.getElementById('completedTasksHome').textContent = completedTasks;
        document.getElementById('pendingTasksHome').textContent = pendingTasks;
        document.getElementById('overdueTasksHome').textContent = overdueTasks;
        
        // Update stats modal
        document.getElementById('totalTasks').textContent = totalTasks;
        document.getElementById('completedTasks').textContent = completedTasks;
        document.getElementById('pendingTasks').textContent = pendingTasks;
        document.getElementById('overdueTasks').textContent = overdueTasks;
        document.getElementById('todayTasks').textContent = todayTasks;
        document.getElementById('weekTasks').textContent = weekTasks;
        
        // Update charts
        updateCharts();
      }
      
      // Fungsi untuk memperbarui dashboard
      function updateDashboard() {
        const totalTasks = tasks.length;
        const completedTasks = tasks.filter(t => t.completed).length;
        const productivity = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        
        // Get focus time from pomodoro stats
        const pomodoros = JSON.parse(localStorage.getItem('tugasku_pomodoros') || '{}');
        const focusTime = pomodoros.total ? pomodoros.total.focusTime.toFixed(1) : '0';
        
        // Update dashboard stats
        document.getElementById('dashboardTotalTasks').textContent = totalTasks;
        document.getElementById('dashboardCompleted').textContent = completedTasks;
        document.getElementById('dashboardFocusTime').textContent = focusTime;
        document.getElementById('dashboardProductivity').textContent = `${productivity}%`;
        
        // Update urgent tasks
        updateUrgentTasks();
        
        // Update achievements
        updateAchievements();
        
        // Update activity chart
        updateDashboardActivityChart();
      }
      
      // Fungsi untuk memperbarui tugas mendesak
      function updateUrgentTasks() {
        const urgentTasksList = document.getElementById('urgentTasksList');
        
        // Get urgent tasks (high priority or overdue)
        const urgentTasks = tasks.filter(task => {
          if (task.completed) return false;
          
          // High priority tasks
          if (task.priority === 'high') return true;
          
          // Overdue tasks
          if (task.deadline && new Date(task.deadline) < new Date()) return true;
          
          // Tasks due today
          const today = new Date().toISOString().split('T')[0];
          if (task.deadline === today) return true;
          
          return false;
        }).slice(0, 5); // Limit to 5 tasks
        
        if (urgentTasks.length === 0) {
          urgentTasksList.innerHTML = `
            <div class="empty-state">
              <p>Tidak ada tugas mendesak</p>
            </div>
          `;
          return;
        }
        
        urgentTasksList.innerHTML = urgentTasks.map(task => {
          const deadlineClass = getDeadlineClass(task.deadline, task.completed);
          const statusText = getDeadlineText(task.deadline);
          
          return `
            <div class="task-card ${deadlineClass}" style="margin-bottom: 10px;">
              <div class="task-title">
                <span class="title-text">${task.title}</span>
                <span class="status-pill ${deadlineClass}">${statusText}</span>
              </div>
              <div class="task-actions">
                <button class="btn" onclick="toggleTaskStatus('${task.id}')"> Selesai</button>
              </div>
            </div>
          `;
        }).join('');
      }
      
      // Fungsi untuk memperbarui pencapaian
      function updateAchievements() {
        const achievementsList = document.getElementById('achievementsList');
        const achievements = [];
        
        // Check for achievements
        const totalTasks = tasks.length;
        const completedTasks = tasks.filter(t => t.completed).length;
        const pomodoros = JSON.parse(localStorage.getItem('tugasku_pomodoros') || '{}');
        const focusTime = pomodoros.total ? pomodoros.total.focusTime : 0;
        
        if (totalTasks >= 10) {
          achievements.push({
            title: ' Produktif',
            description: 'Buat 10 tugas'
          });
        }
        
        if (completedTasks >= 5) {
          achievements.push({
            title: ' Penyelesai',
            description: 'Selesaikan 5 tugas'
          });
        }
        
        if (focusTime >= 5) {
          achievements.push({
            title: ' Fokus',
            description: 'Gunakan 5 jam fokus timer'
          });
        }
        
        if (tasks.some(t => t.priority === 'high')) {
          achievements.push({
            title: ' Prioritas',
            description: 'Buat tugas prioritas tinggi'
          });
        }
        
        if (achievements.length === 0) {
          achievementsList.innerHTML = `
            <div class="empty-state">
              <p>Belum ada pencapaian</p>
            </div>
          `;
          return;
        }
        
        achievementsList.innerHTML = achievements.map(achievement => `
          <div class="task-card" style="margin-bottom: 10px;">
            <div class="task-title">${achievement.title}</div>
            <div class="task-detail">${achievement.description}</div>
          </div>
        `).join('');
      }
      
      // Fungsi untuk inisialisasi chart
      function initCharts() {
        // Home task chart
        const homeTaskCtx = document.getElementById('homeTaskChart').getContext('2d');
        homeTaskChart = new Chart(homeTaskCtx, {
          type: 'doughnut',
          data: {
            labels: ['Selesai', 'Belum Selesai', 'Terlambat'],
            datasets: [{
              data: [0, 0, 0],
              backgroundColor: [
                '#10b981',
                '#f59e0b',
                '#ef4444'
              ],
              borderWidth: 0
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  color: getComputedStyle(document.body).getPropertyValue('--muted'),
                  font: {
                    size: 12
                  }
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `${context.label}: ${context.parsed}`;
                  }
                }
              }
            }
          }
        });
        
        // Task chart for stats modal
        const taskCtx = document.getElementById('taskChart').getContext('2d');
        taskChart = new Chart(taskCtx, {
          type: 'bar',
          data: {
            labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'],
            datasets: [{
              label: 'Tugas Selesai',
              data: [0, 0, 0, 0, 0, 0, 0],
              backgroundColor: '#10b981',
              borderWidth: 0
            }, {
              label: 'Tugas Baru',
              data: [0, 0, 0, 0, 0, 0, 0],
              backgroundColor: '#f59e0b',
              borderWidth: 0
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: {
                  color: getComputedStyle(document.body).getPropertyValue('--muted')
                }
              }
            },
            scales: {
              x: {
                grid: {
                  color: 'rgba(255,255,255,0.1)'
                },
                ticks: {
                  color: getComputedStyle(document.body).getPropertyValue('--muted')
                }
              },
              y: {
                grid: {
                  color: 'rgba(255,255,255,0.1)'
                },
                ticks: {
                  color: getComputedStyle(document.body).getPropertyValue('--muted')
                }
              }
            }
          }
        });
        
        // Priority chart for stats modal
        const priorityCtx = document.getElementById('priorityChart').getContext('2d');
        priorityChart = new Chart(priorityCtx, {
          type: 'pie',
          data: {
            labels: ['Tinggi', 'Sedang', 'Rendah'],
            datasets: [{
              data: [0, 0, 0],
              backgroundColor: [
                '#ef4444',
                '#f59e0b',
                '#10b981'
              ],
              borderWidth: 0
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  color: getComputedStyle(document.body).getPropertyValue('--muted'),
                  font: {
                    size: 12
                  }
                }
              }
            }
          }
        });
        
        // Productivity chart
        const productivityCtx = document.getElementById('productivityChart').getContext('2d');
        productivityChart = new Chart(productivityCtx, {
          type: 'line',
          data: {
            labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'],
            datasets: [{
              label: 'Fokus (menit)',
              data: [0, 0, 0, 0, 0, 0, 0],
              borderColor: '#8B5CF6',
              backgroundColor: 'rgba(139, 92, 246, 0.1)',
              tension: 0.3,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: {
                  color: getComputedStyle(document.body).getPropertyValue('--muted')
                }
              }
            },
            scales: {
              x: {
                grid: {
                  color: 'rgba(255,255,255,0.1)'
                },
                ticks: {
                  color: getComputedStyle(document.body).getPropertyValue('--muted')
                }
              },
              y: {
                grid: {
                  color: 'rgba(255,255,255,0.1)'
                },
                ticks: {
                  color: getComputedStyle(document.body).getPropertyValue('--muted')
                }
              }
            }
          }
        });
        
        // Dashboard activity chart
        const dashboardActivityCtx = document.getElementById('dashboardActivityChart').getContext('2d');
        dashboardActivityChart = new Chart(dashboardActivityCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [{
              label: 'Tugas Selesai',
              data: [],
              borderColor: '#10b981',
              backgroundColor: 'rgba(16, 185, 129, 0.1)',
              tension: 0.3,
              fill: true
            }, {
              label: 'Tugas Dibuat',
              data: [],
              borderColor: '#8B5CF6',
              backgroundColor: 'rgba(139, 92, 246, 0.1)',
              tension: 0.3,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: {
                  color: getComputedStyle(document.body).getPropertyValue('--muted')
                }
              }
            },
            scales: {
              x: {
                grid: {
                  color: 'rgba(255,255,255,0.1)'
                },
                ticks: {
                  color: getComputedStyle(document.body).getPropertyValue('--muted')
                }
              },
              y: {
                grid: {
                  color: 'rgba(255,255,255,0.1)'
                },
                ticks: {
                  color: getComputedStyle(document.body).getPropertyValue('--muted')
                }
              }
            }
          }
        });
        
        // Update charts with initial data
        updateCharts();
      }
      
      // Fungsi untuk memperbarui chart
      function updateCharts() {
        if (!homeTaskChart || !taskChart || !priorityChart) return;
        
        // Home task chart data
        const completedTasks = tasks.filter(t => t.completed).length;
        const pendingTasks = tasks.filter(t => !t.completed).length;
        const overdueTasks = tasks.filter(t => 
          !t.completed && t.deadline && new Date(t.deadline) < new Date()
        ).length;
        
        homeTaskChart.data.datasets[0].data = [completedTasks, pendingTasks, overdueTasks];
        homeTaskChart.update();
        
        // Task chart data (weekly)
        const weekData = getWeeklyTaskData();
        taskChart.data.datasets[0].data = weekData.completed;
        taskChart.data.datasets[1].data = weekData.created;
        taskChart.update();
        
        // Priority chart data
        const highPriority = tasks.filter(t => t.priority === 'high').length;
        const mediumPriority = tasks.filter(t => t.priority === 'medium').length;
        const lowPriority = tasks.filter(t => t.priority === 'low').length;
        
        priorityChart.data.datasets[0].data = [highPriority, mediumPriority, lowPriority];
        priorityChart.update();
        
        // Productivity chart data
        const productivityData = getWeeklyProductivityData();
        productivityChart.data.datasets[0].data = productivityData;
        productivityChart.update();
      }
      
      // Fungsi untuk memperbarui dashboard activity chart
      function updateDashboardActivityChart() {
        if (!dashboardActivityChart) return;
        
        const activityData = getRecentActivityData();
        dashboardActivityChart.data.labels = activityData.labels;
        dashboardActivityChart.data.datasets[0].data = activityData.completed;
        dashboardActivityChart.data.datasets[1].data = activityData.created;
        dashboardActivityChart.update();
      }
      
      // Fungsi untuk mendapatkan data tugas mingguan
      function getWeeklyTaskData() {
        const days = ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'];
        const completed = Array(7).fill(0);
        const created = Array(7).fill(0);
        
        // Get start of week (Monday)
        const now = new Date();
        const startOfWeek = new Date(now);
        startOfWeek.setDate(now.getDate() - now.getDay() + (now.getDay() === 0 ? -6 : 1));
        startOfWeek.setHours(0, 0, 0, 0);
        
        tasks.forEach(task => {
          const taskDate = new Date(task.createdAt);
          const dayIndex = (taskDate.getDay() + 6) % 7; // Convert to Monday-based week
          
          if (taskDate >= startOfWeek) {
            created[dayIndex]++;
          }
          
          if (task.completed && task.updatedAt) {
            const completedDate = new Date(task.updatedAt);
            const completedDayIndex = (completedDate.getDay() + 6) % 7;
            
            if (completedDate >= startOfWeek) {
              completed[completedDayIndex]++;
            }
          }
        });
        
        return { completed, created };
      }
      
      // Fungsi untuk mendapatkan data produktivitas mingguan
      function getWeeklyProductivityData() {
        // For now, return mock data
        // In a real app, this would track actual focus time per day
        return [25, 45, 30, 50, 40, 20, 35];
      }
      
      // Fungsi untuk mendapatkan data aktivitas terkini
      function getRecentActivityData() {
        const labels = [];
        const completed = [];
        const created = [];
        
        // Get last 7 days
        for (let i = 6; i >= 0; i--) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          const label = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
          labels.push(label);
          
          const dateStr = date.toISOString().split('T')[0];
          
          // Count tasks completed on this day
          const completedCount = tasks.filter(task => {
            if (!task.completed || !task.updatedAt) return false;
            const completedDate = new Date(task.updatedAt).toISOString().split('T')[0];
            return completedDate === dateStr;
          }).length;
          
          // Count tasks created on this day
          const createdCount = tasks.filter(task => {
            const createdDate = new Date(task.createdAt).toISOString().split('T')[0];
            return createdDate === dateStr;
          }).length;
          
          completed.push(completedCount);
          created.push(createdCount);
        }
        
        return { labels, completed, created };
      }
      
      // Fungsi untuk menampilkan toast
      function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = 'toast';
        toast.classList.add('show');
        
        if (type === 'error') {
          toast.style.background = 'var(--danger)';
        } else if (type === 'warning') {
          toast.style.background = 'var(--warning)';
        }
        
        setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
      }
      
      // Fungsi untuk membuka modal statistik
      function openStatsModal() {
        updateStats();
        document.getElementById('statsModal').classList.add('show');
      }
      
      // Fungsi untuk menutup modal statistik
      function closeStatsModal() {
        document.getElementById('statsModal').classList.remove('show');
      }
      
      // Fungsi untuk membuka modal tema
      function openThemeModal() {
        document.getElementById('themeModal').classList.add('show');
      }
      
      // Fungsi untuk menutup modal tema
      function closeThemeModal() {
        document.getElementById('themeModal').classList.remove('show');
      }
      
      // Fungsi untuk mengubah tema
      function changeTheme(e) {
        const theme = e.currentTarget.getAttribute('data-theme');
        setTheme(theme);
        closeThemeModal();
        showToast(`Tema ${theme} diterapkan`);
      }
      
      // Fungsi untuk membuka modal profil
      function openProfileModal() {
        const savedProfile = localStorage.getItem('tugasku_profile');
        if (savedProfile) {
          const profile = JSON.parse(savedProfile);
          document.getElementById('profileNameInput').value = profile.name || '';
          document.getElementById('profileBioInput').value = profile.bio || '';
          document.getElementById('profileDisplayName').textContent = profile.name || 'Nama Pengguna';
          document.getElementById('profileDisplayBio').textContent = profile.bio || 'Bio Pengguna';
          document.getElementById('profileAvatarImg').src = profile.avatarImg || '';
          
          // Select the current avatar
          document.querySelectorAll('.avatar-option').forEach(option => {
            option.classList.remove('selected');
            if (option.getAttribute('data-avatar') === profile.avatar) {
              option.classList.add('selected');
            }
          });
        }
        
        document.getElementById('profileModal').classList.add('show');
      }
      
      // Fungsi untuk menutup modal profil
      function closeProfileModal() {
        document.getElementById('profileModal').classList.remove('show');
      }
      
      // Fungsi untuk menyimpan profil
      function saveProfile() {
        const name = document.getElementById('profileNameInput').value.trim();
        const bio = document.getElementById('profileBioInput').value.trim();
        const selectedAvatar = document.querySelector('.avatar-option.selected');
        const avatar = selectedAvatar ? selectedAvatar.getAttribute('data-avatar') : '';
        const avatarImg = document.getElementById('profileAvatarImg').src;
        
        const profile = {
          name: name || 'Pengguna TugasKu',
          bio: bio || 'Pelajar Aktif',
          avatar,
          avatarImg
        };
        
        localStorage.setItem('tugasku_profile', JSON.stringify(profile));
        updateProfileUI(profile);
        closeProfileModal();
        showToast('Profil berhasil disimpan');
      }
      
      // Fungsi untuk memilih avatar
      function selectAvatar(e) {
        document.querySelectorAll('.avatar-option').forEach(option => {
          option.classList.remove('selected');
        });
        e.currentTarget.classList.add('selected');
      }
      
      // Fungsi untuk menangani upload avatar
      function handleAvatarUpload(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        if (!file.type.startsWith('image/')) {
          showToast('Silakan pilih file gambar', 'error');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = function(event) {
          cropImage = new Image();
          cropImage.onload = function() {
            openCropModal(event.target.result);
          };
          cropImage.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
      
      // Fungsi untuk membuka modal crop
      function openCropModal(imageSrc) {
        document.getElementById('cropModal').classList.add('show');
        
        // Initialize crop canvas
        cropCanvas = document.getElementById('cropCanvas');
        cropCtx = cropCanvas.getContext('2d');
        cropArea = document.getElementById('cropArea');
        
        // Set canvas size
        cropCanvas.width = cropCanvas.offsetWidth;
        cropCanvas.height = cropCanvas.offsetHeight;
        
        // Draw image on canvas
        cropCtx.drawImage(cropImage, 0, 0, cropCanvas.width, cropCanvas.height);
        
        // Initialize crop area
        initCropArea();
        
        // Update preview
        updateCropPreview();
      }
      
      // Fungsi untuk inisialisasi area crop
      function initCropArea() {
        const size = Math.min(cropCanvas.width, cropCanvas.height) * 0.7;
        const x = (cropCanvas.width - size) / 2;
        const y = (cropCanvas.height - size) / 2;
        
        cropArea.style.width = size + 'px';
        cropArea.style.height = size + 'px';
        cropArea.style.left = x + 'px';
        cropArea.style.top = y + 'px';
        cropArea.style.display = 'block';
        
        // Add event listeners for dragging and resizing
        cropArea.addEventListener('mousedown', startDrag);
        cropArea.addEventListener('touchstart', startDrag);
        
        document.querySelectorAll('.crop-handle').forEach(handle => {
          handle.addEventListener('mousedown', startResize);
          handle.addEventListener('touchstart', startResize);
        });
        
        document.addEventListener('mousemove', drag);
        document.addEventListener('touchmove', drag);
        document.addEventListener('mouseup', stopDrag);
        document.addEventListener('touchend', stopDrag);
      }
      
      // Fungsi untuk memulai drag
      function startDrag(e) {
        e.preventDefault();
        isDragging = true;
        
        const rect = cropArea.getBoundingClientRect();
        startX = (e.clientX || e.touches[0].clientX) - rect.left;
        startY = (e.clientY || e.touches[0].clientY) - rect.top;
      }
      
      // Fungsi untuk memulai resize
      function startResize(e) {
        e.preventDefault();
        e.stopPropagation();
        isResizing = true;
        resizeDirection = e.currentTarget.className.split(' ')[1]; // nw, ne, sw, se
        
        const rect = cropArea.getBoundingClientRect();
        startX = e.clientX || e.touches[0].clientX;
        startY = e.clientY || e.touches[0].clientY;
      }
      
      // Fungsi untuk drag
      function drag(e) {
        if (!isDragging && !isResizing) return;
        e.preventDefault();
        
        const clientX = e.clientX || (e.touches && e.touches[0].clientX);
        const clientY = e.clientY || (e.touches && e.touches[0].clientY);
        
        if (isDragging) {
          // Calculate new position
          const newX = clientX - startX;
          const newY = clientY - startY;
          
          // Constrain to canvas bounds
          const maxX = cropCanvas.width - cropArea.offsetWidth;
          const maxY = cropCanvas.height - cropArea.offsetHeight;
          
          cropArea.style.left = Math.max(0, Math.min(newX, maxX)) + 'px';
          cropArea.style.top = Math.max(0, Math.min(newY, maxY)) + 'px';
        } else if (isResizing) {
          // Calculate new size based on resize direction
          const rect = cropArea.getBoundingClientRect();
          const deltaX = clientX - startX;
          const deltaY = clientY - startY;
          
          let newWidth = rect.width;
          let newHeight = rect.height;
          let newLeft = parseFloat(cropArea.style.left);
          let newTop = parseFloat(cropArea.style.top);
          
          // Adjust based on resize direction
          switch(resizeDirection) {
            case 'nw':
              newWidth -= deltaX;
              newHeight -= deltaY;
              newLeft += deltaX;
              newTop += deltaY;
              break;
            case 'ne':
              newWidth += deltaX;
              newHeight -= deltaY;
              newTop += deltaY;
              break;
            case 'sw':
              newWidth -= deltaX;
              newHeight += deltaY;
              newLeft += deltaX;
              break;
            case 'se':
              newWidth += deltaX;
              newHeight += deltaY;
              break;
          }
          
          // Constrain minimum size
          const minSize = 50;
          newWidth = Math.max(minSize, newWidth);
          newHeight = Math.max(minSize, newHeight);
          
          // Constrain to canvas bounds
          newLeft = Math.max(0, Math.min(newLeft, cropCanvas.width - newWidth));
          newTop = Math.max(0, Math.min(newTop, cropCanvas.height - newHeight));
          
          // Apply new size and position
          cropArea.style.width = newWidth + 'px';
          cropArea.style.height = newHeight + 'px';
          cropArea.style.left = newLeft + 'px';
          cropArea.style.top = newTop + 'px';
          
          // Update start position for next move
          startX = clientX;
          startY = clientY;
        }
        
        updateCropPreview();
      }
      
      // Fungsi untuk menghentikan drag
      function stopDrag() {
        isDragging = false;
        isResizing = false;
        resizeDirection = null;
      }
      
      // Fungsi untuk memperbarui ukuran crop
      function updateCropSize(e) {
        cropSize = parseInt(e.target.value);
        document.getElementById('cropSizeValue').textContent = cropSize + '%';
        updateCropPreview();
      }
      
      // Fungsi untuk memperbarui preview crop
      function updateCropPreview() {
        const preview = document.getElementById('cropPreview');
        const previewCanvas = document.createElement('canvas');
        const previewCtx = previewCanvas.getContext('2d');
        
        // Set preview size
        const previewSize = 100;
        previewCanvas.width = previewSize;
        previewCanvas.height = previewSize;
        
        // Get crop area coordinates
        const cropX = parseFloat(cropArea.style.left);
        const cropY = parseFloat(cropArea.style.top);
        const cropWidth = parseFloat(cropArea.style.width);
        const cropHeight = parseFloat(cropArea.style.height);
        
        // Apply size adjustment
        const adjustedWidth = cropWidth * (cropSize / 100);
        const adjustedHeight = cropHeight * (cropSize / 100);
        const adjustedX = cropX + (cropWidth - adjustedWidth) / 2;
        const adjustedY = cropY + (cropHeight - adjustedHeight) / 2;
        
        // Draw cropped image to preview
        previewCtx.drawImage(
          cropImage,
          adjustedX, adjustedY, adjustedWidth, adjustedHeight,
          0, 0, previewSize, previewSize
        );
        
        // Update preview image
        preview.src = previewCanvas.toDataURL();
      }
      
      // Fungsi untuk menutup modal crop
      function closeCropModal() {
        document.getElementById('cropModal').classList.remove('show');
        cropImage = null;
      }
      
      // Fungsi untuk menerapkan crop
      function applyCrop() {
        if (!cropImage) return;
        
        const preview = document.getElementById('cropPreview');
        document.getElementById('profileAvatarImg').src = preview.src;
        
        // Update profile with cropped image
        const savedProfile = localStorage.getItem('tugasku_profile');
        if (savedProfile) {
          const profile = JSON.parse(savedProfile);
          profile.avatarImg = preview.src;
          localStorage.setItem('tugasku_profile', JSON.stringify(profile));
          updateProfileUI(profile);
        }
        
        closeCropModal();
        showToast('Foto profil berhasil diubah');
      }
      
      // Fungsi untuk membuka modal pengaturan
      function openSettingsModal() {
        const savedSettings = localStorage.getItem('tugasku_settings');
        if (savedSettings) {
          const settings = JSON.parse(savedSettings);
          
          // Update form with saved settings
          document.getElementById('notificationsEnabled').checked = settings.notifications?.enabled || false;
          document.getElementById('notificationLeadDays').value = settings.notifications?.leadDays || '1';
          document.getElementById('useBrowserNotification').checked = settings.notifications?.useBrowser || false;
          document.getElementById('autoSaveEnabled').checked = settings.autoSave || false;
          document.getElementById('quickActionsEnabled').checked = settings.quickActions || false;
          document.getElementById('darkReaderEnabled').checked = settings.darkReader || false;
          document.getElementById('liteMode').checked = settings.liteMode || false;
        }
        
        document.getElementById('settingsModal').classList.add('show');
      }
      
      // Fungsi untuk menutup modal pengaturan
      function closeSettingsModal() {
        document.getElementById('settingsModal').classList.remove('show');
      }
      
      // Fungsi untuk menyimpan pengaturan
      function saveSettingsFunc() {
        const settings = {
          notifications: {
            enabled: document.getElementById('notificationsEnabled').checked,
            leadDays: document.getElementById('notificationLeadDays').value,
            useBrowser: document.getElementById('useBrowserNotification').checked
          },
          autoSave: document.getElementById('autoSaveEnabled').checked,
          quickActions: document.getElementById('quickActionsEnabled').checked,
          darkReader: document.getElementById('darkReaderEnabled').checked,
          liteMode: document.getElementById('liteMode').checked,
          timer: {
            durations: {
              focus: FOCUS_TIME / 60,
              short: SHORT_BREAK_TIME / 60,
              long: LONG_BREAK_TIME / 60
            }
          }
        };
        
        localStorage.setItem('tugasku_settings', JSON.stringify(settings));
        applySettings(settings);
        closeSettingsModal();
        showToast('Pengaturan berhasil disimpan');
      }
      
      // Fungsi untuk membuka modal tips
      function openTipsModal() {
        document.getElementById('tipsModal').classList.add('show');
      }
      
      // Fungsi untuk menutup modal tips
      function closeTipsModal() {
        document.getElementById('tipsModal').classList.remove('show');
      }
      
      // Fungsi untuk membuka modal tentang
      function openAboutModal() {
        document.getElementById('aboutModal').classList.add('show');
      }
      
      // Fungsi untuk menutup modal tentang
      function closeAboutModal() {
        document.getElementById('aboutModal').classList.remove('show');
      }
      
      // Fungsi untuk menyimpan pengaturan timer
      function saveTimerSettings() {
        const focusDuration = parseInt(document.getElementById('focusDurationSetting').value);
        const shortBreakDuration = parseInt(document.getElementById('shortBreakDurationSetting').value);
        const longBreakDuration = parseInt(document.getElementById('longBreakDurationSetting').value);
        
        if (isNaN(focusDuration) || isNaN(shortBreakDuration) || isNaN(longBreakDuration)) {
          showToast('Semua durasi harus diisi dengan angka', 'error');
          return;
        }
        
        if (focusDuration < 1 || shortBreakDuration < 1 || longBreakDuration < 1) {
          showToast('Durasi harus lebih dari 0 menit', 'error');
          return;
        }
        
        // Update timer durations
        FOCUS_TIME = focusDuration * 60;
        SHORT_BREAK_TIME = shortBreakDuration * 60;
        LONG_BREAK_TIME = longBreakDuration * 60;
        
        // Save to settings
        const savedSettings = localStorage.getItem('tugasku_settings');
        if (savedSettings) {
          const settings = JSON.parse(savedSettings);
          settings.timer = settings.timer || {};
          settings.timer.durations = {
            focus: focusDuration,
            short: shortBreakDuration,
            long: longBreakDuration
          };
          localStorage.setItem('tugasku_settings', JSON.stringify(settings));
        }
        
        // Reset timer with new durations
        resetTimer();
        
        showToast('Pengaturan timer berhasil disimpan');
      }
      
      // Fungsi untuk memperbarui tampilan pengaturan timer
      function updateTimerSettingsDisplay() {
        document.getElementById('focusDurationSetting').value = FOCUS_TIME / 60;
        document.getElementById('shortBreakDurationSetting').value = SHORT_BREAK_TIME / 60;
        document.getElementById('longBreakDurationSetting').value = LONG_BREAK_TIME / 60;
      }
      
      // Fungsi untuk memulai pemeriksa notifikasi
      function startNotificationChecker() {
        // Check for notifications every minute
        setInterval(() => {
          checkForNotifications();
        }, 60000);
        
        // Initial check
        checkForNotifications();
      }
      
      // Fungsi untuk memeriksa notifikasi
      function checkForNotifications() {
        const savedSettings = localStorage.getItem('tugasku_settings');
        if (!savedSettings) return;
        
        const settings = JSON.parse(savedSettings);
        if (!settings.notifications?.enabled) return;
        
        const leadDays = parseInt(settings.notifications.leadDays) || 1;
        const today = new Date();
        const notificationDate = new Date(today);
        notificationDate.setDate(today.getDate() + leadDays);
        
        const upcomingTasks = tasks.filter(task => {
          if (task.completed || !task.deadline) return false;
          
          const taskDate = new Date(task.deadline);
          return taskDate.toDateString() === notificationDate.toDateString();
        });
        
        if (upcomingTasks.length > 0) {
          updateNotificationBadge(upcomingTasks.length);
          
          // Show browser notification if enabled
          if (settings.notifications.useBrowser && 'Notification' in window) {
            if (Notification.permission === 'granted') {
              new Notification('TugasKu3 PRO - Pengingat Tugas', {
                body: `Anda memiliki ${upcomingTasks.length} tugas yang deadline dalam ${leadDays} hari`,
                icon: 'my-icon.png'
              });
            } else if (Notification.permission === 'default') {
              Notification.requestPermission();
            }
          }
        } else {
          updateNotificationBadge(0);
        }
      }
      
      // Fungsi untuk memperbarui badge notifikasi
      function updateNotificationBadge(count = null) {
        const notifBadge = document.getElementById('notifBadge');
        
        if (count === null) {
          // Calculate count based on upcoming tasks
          const leadDays = 1; // Default to 1 day
          const today = new Date();
          const notificationDate = new Date(today);
          notificationDate.setDate(today.getDate() + leadDays);
          
          count = tasks.filter(task => {
            if (task.completed || !task.deadline) return false;
            
            const taskDate = new Date(task.deadline);
            return taskDate.toDateString() === notificationDate.toDateString();
          }).length;
        }
        
        if (count > 0) {
          notifBadge.textContent = count > 9 ? '9+' : count;
          notifBadge.style.display = 'flex';
        } else {
          notifBadge.style.display = 'none';
        }
      }
      
      // Fungsi untuk membuka modal notifikasi
      function openNotificationsModal() {
        const notificationsList = document.getElementById('notificationsList');
        
        // Get upcoming tasks
        const today = new Date();
        const upcomingTasks = [];
        
        // Check for tasks due today
        const todayTasks = tasks.filter(task => {
          if (task.completed || !task.deadline) return false;
          
          const taskDate = new Date(task.deadline);
          return taskDate.toDateString() === today.toDateString();
        });
        
        if (todayTasks.length > 0) {
          upcomingTasks.push({
            type: 'today',
            title: 'Tugas Deadline Hari Ini',
            message: `Anda memiliki ${todayTasks.length} tugas yang harus diselesaikan hari ini`,
            tasks: todayTasks,
            time: 'Hari ini'
          });
        }
        
        // Check for tasks due tomorrow
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);
        
        const tomorrowTasks = tasks.filter(task => {
          if (task.completed || !task.deadline) return false;
          
          const taskDate = new Date(task.deadline);
          return taskDate.toDateString() === tomorrow.toDateString();
        });
        
        if (tomorrowTasks.length > 0) {
          upcomingTasks.push({
            type: 'tomorrow',
            title: 'Tugas Deadline Besok',
            message: `Anda memiliki ${tomorrowTasks.length} tugas yang deadline besok`,
            tasks: tomorrowTasks,
            time: 'Besok'
          });
        }
        
        // Check for overdue tasks
        const overdueTasks = tasks.filter(task => {
          if (task.completed || !task.deadline) return false;
          
          const taskDate = new Date(task.deadline);
          return taskDate < today;
        });
        
        if (overdueTasks.length > 0) {
          upcomingTasks.push({
            type: 'overdue',
            title: 'Tugas Terlambat',
            message: `Anda memiliki ${overdueTasks.length} tugas yang terlambat`,
            tasks: overdueTasks,
            time: 'Terlambat'
          });
        }
        
        if (upcomingTasks.length === 0) {
          notificationsList.innerHTML = `
            <div class="empty-state">
              <h3>Tidak ada notifikasi</h3>
              <p>Notifikasi akan muncul di sini</p>
            </div>
          `;
        } else {
          notificationsList.innerHTML = upcomingTasks.map(notification => `
            <div class="notification-item ${notification.type === 'overdue' ? 'unread' : ''}">
              <div class="notification-icon" style="background: ${getNotificationColor(notification.type)}">
                ${getNotificationIcon(notification.type)}
              </div>
              <div class="notification-content">
                <div class="notification-title">${notification.title}</div>
                <div class="notification-message">${notification.message}</div>
                <div class="notification-time">${notification.time}</div>
              </div>
            </div>
          `).join('');
        }
        
        document.getElementById('notificationsModal').classList.add('show');
        
        // Clear notification badge when opened
        updateNotificationBadge(0);
      }
      
      // Fungsi untuk mendapatkan warna notifikasi
      function getNotificationColor(type) {
        switch(type) {
          case 'today': return 'var(--warning)';
          case 'tomorrow': return 'var(--primary)';
          case 'overdue': return 'var(--danger)';
          default: return 'var(--muted)';
        }
      }
      
      // Fungsi untuk mendapatkan ikon notifikasi
      function getNotificationIcon(type) {
        switch(type) {
          case 'today': return '';
          case 'tomorrow': return '';
          case 'overdue': return '';
          default: return '';
        }
      }
      
      // Fungsi untuk menutup modal notifikasi
      function closeNotificationsModal() {
        document.getElementById('notificationsModal').classList.remove('show');
      }
      
      // Fungsi untuk backup data
      function backupData() {
        const data = {
          tasks,
          schedules,
          notes,
          profile: JSON.parse(localStorage.getItem('tugasku_profile') || '{}'),
          settings: JSON.parse(localStorage.getItem('tugasku_settings') || '{}'),
          pomodoros: JSON.parse(localStorage.getItem('tugasku_pomodoros') || '{}'),
          version: '5.0.0'
        };
        
        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const url = URL.createObjectURL(dataBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `tugasku3-backup-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showToast('Backup data berhasil diunduh');
      }
      
      // Fungsi untuk ekspor data
      function exportData() {
        backupData(); // Same as backup for now
      }
      
      // Fungsi untuk impor data
      function importData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        
        input.onchange = e => {
          const file = e.target.files[0];
          if (!file) return;
          
          const reader = new FileReader();
          reader.onload = function(event) {
            try {
              const data = JSON.parse(event.target.result);
              
              // Validate data structure
              if (!data.tasks || !data.schedules || !data.notes) {
                throw new Error('Format file tidak valid');
              }
              
              // Import data
              tasks = data.tasks;
              schedules = data.schedules;
              notes = data.notes;
              
              if (data.profile) {
                localStorage.setItem('tugasku_profile', JSON.stringify(data.profile));
              }
              
              if (data.settings) {
                localStorage.setItem('tugasku_settings', JSON.stringify(data.settings));
              }
              
              if (data.pomodoros) {
                localStorage.setItem('tugasku_pomodoros', JSON.stringify(data.pomodoros));
              }
              
              saveData();
              renderTasks();
              renderSchedules();
              renderNotes();
              updateStats();
              updateDashboard();
              updateNotificationBadge();
              initSettings();
              
              showToast('Data berhasil diimpor');
            } catch (error) {
              showToast('Gagal mengimpor data: ' + error.message, 'error');
            }
          };
          reader.readAsText(file);
        };
        
        input.click();
      }
      
      // Fungsi untuk reset data
      function resetData() {
        if (confirm('Apakah Anda yakin ingin mereset semua data? Tindakan ini tidak dapat dibatalkan.')) {
          tasks = [];
          schedules = [];
          notes = [];
          
          localStorage.removeItem('tugasku_tasks');
          localStorage.removeItem('tugasku_schedules');
          localStorage.removeItem('tugasku_notes');
          localStorage.removeItem('tugasku_profile');
          localStorage.removeItem('tugasku_settings');
          localStorage.removeItem('tugasku_pomodoros');
          
          renderTasks();
          renderSchedules();
          renderNotes();
          updateStats();
          updateDashboard();
          updateNotificationBadge();
          
          showToast('Semua data telah direset');
        }
      }
      
      // Update primary color RGB on theme change
      updatePrimaryColorRGB();
    });
  </script>
</body>
</html>